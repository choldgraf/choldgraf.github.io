{"kind":"Notebook","sha256":"ead2c6ce26de9b059b857e11ead3751a52e9269e5414147997d5ddbae6af383b","slug":"blog.2015.2015-09-27-craigslist-data-analysis","location":"/blog/2015/2015-09-27-craigslist_data_analysis.ipynb","dependencies":[],"frontmatter":{"title":"Craigslist data analysis","tags":["python","scraping","data analysis","visualization"],"date":"2015-09-27","kernelspec":{"name":"python3","display_name":"Python 3","language":"python"},"github":"https://github.com/choldgraf/choldgraf.github.io","exports":[{"format":"ipynb","filename":"2015-09-27-craigslist_data_analysis.ipynb","url":"/build/2015-09-27-craigslis-f2346a5dd558ab40181e5597e2630c57.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"text","value":"Using Craigslist to compare prices in the Bay Area","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"tyE7frlyE5"}],"identifier":"using-craigslist-to-compare-prices-in-the-bay-area","label":"Using Craigslist to compare prices in the Bay Area","html_id":"using-craigslist-to-compare-prices-in-the-bay-area","implicit":true,"key":"MO7969t5ll"},{"type":"paragraph","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"children":[{"type":"text","value":"In the ","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"vyHjRv2raB"},{"type":"link","url":"http://chrisholdgraf.com/querying-craigslist-with-python/","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"children":[{"type":"text","value":"last post","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"H7GcgqXY8a"}],"urlSource":"http://chrisholdgraf.com/querying-craigslist-with-python/","key":"syb0cBAzjg"},{"type":"text","value":" I showed how to use a simple python bot to scrape data from Criagslist. This is a quick follow-up to take a peek at the data.","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"tKx5s3KjeL"}],"key":"uFIZtX8qd9"},{"type":"blockquote","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"children":[{"type":"text","value":"Note - data that you scrape from Craigslist is pretty limited. They tend to clear out old posts, and you can only scrape from recent posts anyway to avoid them blocking you.","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"tWRVdPbqlC"}],"key":"cXHMixiyGV"}],"key":"ABPLJL1a98"},{"type":"paragraph","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"children":[{"type":"text","value":"Now that we’ve got some craigslist data, what questions can we ask? Well, a good start would be to see where we want (or don’t want) to rent our house. Let’s compare the housing market in a few different regions of the Bay Area.","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"key":"IsNGiCfINx"}],"key":"ezP5ZEnH6R"}],"key":"TyGmj7BoUg"},{"type":"block","kind":"notebook-code","data":{"collapsed":true,"jupyter":{"outputs_hidden":true}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Seaborn can help create some pretty plots\nimport seaborn as sns\nimport pandas as pd\nfrom matplotlib import pyplot as plt\nimport matplotlib as mpl\nimport numpy as np\n%matplotlib inline\nsns.set_palette('colorblind')\nsns.set_style('white')","key":"tWXnxqdu2C"},{"type":"output","id":"ArE36TL0vdMOlWx0Bvyym","data":[],"key":"lcj8PwtTgJ"}],"key":"WAzmBJ0QtU"},{"type":"block","kind":"notebook-code","data":{"collapsed":true,"jupyter":{"outputs_hidden":true}},"children":[{"type":"code","lang":"python","executable":true,"value":"# First we'll load the data we pulled from before\nresults = pd.read_csv('../data/craigslist_results.csv')","key":"LFW39Lo9c2"},{"type":"output","id":"z-eO-PzIC6yq_z-dH77tP","data":[],"key":"uRH44uxSyQ"}],"key":"UPnz9MFXGP"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Price distributions","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"gp8O78yhUq"}],"identifier":"price-distributions","label":"Price distributions","html_id":"price-distributions","implicit":true,"key":"doPXuPDDTQ"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"As a start, let’s take a look at the distribution of home prices to get an idea for what we’re dealing with:","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"YOnanVxN2y"}],"key":"O9kZmEd62U"}],"key":"XvG7KFD36f"},{"type":"block","kind":"notebook-code","data":{"collapsed":false,"jupyter":{"outputs_hidden":false}},"children":[{"type":"code","lang":"python","executable":true,"value":"f, ax = plt.subplots(figsize=(10, 5))\nsns.distplot(results['price'].dropna())","key":"bszxCQT2N8"},{"type":"output","id":"38a0VGG_YUqrP9Cmh4wwP","data":[{"output_type":"execute_result","execution_count":3,"metadata":{},"data":{}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"d623bfc6b8a50ae5694fc372025e0d6b","path":"/build/d623bfc6b8a50ae5694fc372025e0d6b.png"}}}],"key":"Egp2tLsd2X"}],"key":"fp8rHrYHIk"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"That’s not super useful - it looks like we have a highly skewed distribution with a few instances way out to the right. We’ll convert to a log scale from here on to make it easier to comprehend:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"pFXppeWXSw"}],"key":"tlJayGaRFl"}],"key":"vj8DEWuFhY"},{"type":"block","kind":"notebook-code","data":{"collapsed":false,"jupyter":{"outputs_hidden":false}},"children":[{"type":"code","lang":"python","executable":true,"value":"f, ax = plt.subplots(figsize=(10, 5))\nresults['logprice'] = results['price'].apply(np.log10)\nsns.distplot(results['logprice'].dropna())\nax.set(title=\"Log plots are nicer for skewed data\")","key":"U0aJdMB78u"},{"type":"output","id":"XGodUI8eZBqmx_ixT7BUT","data":[{"output_type":"execute_result","execution_count":4,"metadata":{},"data":{"text/plain":{"content":"[&ltmatplotlib.text.Text at 0x1141cb690&gt]","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"eba5222c9d9360864886676c578df661","path":"/build/eba5222c9d9360864886676c578df661.png"}}}],"key":"ahaBPiL9Q0"}],"key":"UrGNVZuEYP"},{"type":"block","kind":"notebook-code","data":{"collapsed":false,"jupyter":{"outputs_hidden":false}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Don't forget the log mappings:\nprint(['10**{0} = {1}'.format(i, 10**i) for i in ax.get_xlim()])","key":"boYFJvIiNr"},{"type":"output","id":"XsbidONAaQsn8akJZYN_7","data":[],"key":"PodIxDEMUm"}],"key":"iK5nfJ5oUd"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"However, what we really want is to look at the breakdown of prices for a few locations in the bay area. Luckily Craigslist stores this in the URL of our search, so we can easily split this up with a pandas ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"DIzgvFMeOZ"},{"type":"inlineCode","value":"groupby","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"kGdBehaIVr"},{"type":"text","value":":","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"CXl4l5jQCq"}],"key":"iYneO2SNkW"}],"key":"uuLPViN7Pa"},{"type":"block","kind":"notebook-code","data":{"collapsed":false,"jupyter":{"outputs_hidden":false}},"children":[{"type":"code","lang":"python","executable":true,"value":"f, ax_hist = plt.subplots(figsize=(10, 5))\nfor loc, vals in results.groupby('loc'):\n    sns.distplot(vals['logprice'].dropna(), label=loc, ax=ax_hist)\n    ax_hist.legend()\n    ax_hist.set(title='San Francisco is too damn expensive')","key":"xEoVQNfmet"},{"type":"output","id":"n79lKlJhXLq3x_fyhmNbC","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"696e116526856b1a756cbfa70e0b58ee","path":"/build/696e116526856b1a756cbfa70e0b58ee.png"}}}],"key":"jzI1FGOT0c"}],"key":"IszffStBa2"},{"type":"block","kind":"notebook-code","data":{"collapsed":false,"jupyter":{"outputs_hidden":false}},"children":[{"type":"code","lang":"python","executable":true,"value":"summary = results.groupby('loc').describe()['logprice'].unstack('loc')\nfor loc, vals in summary.iteritems():\n    print('{0}: {1}+/-{2}'.format(loc, vals['mean'], vals['std']/vals.shape[0]))\n    \nprint('Differences on the order of: $' + str(10**3.65 - 10**3.4))","key":"oxd3ySPCot"},{"type":"output","id":"5m_fejGmXR8F5yiJJhhfa","data":[],"key":"dsXS5GHYA6"}],"key":"yOk9Ij4qTc"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"That’s a bit unsurprising - San Francisco is significantly more expensive than any other region in the area. Note that this is a log scale, so small differences at this scale == large differences in the raw values.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"XwM6ZraXla"}],"key":"K4XbhhtKaD"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"However, it looks like the shapes of these prices are different as well. If any of these distributions aren’t symmetric around the center, then describing it with the mean +/- standard deviation isn’t so great.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"fjkLM1i0zk"}],"key":"kixl76nMA4"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Perhaps a better way to get an idea for what kind of deal we’re getting is to directly calculate price per square foot. Let’s see how this scales as the houses go up.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"WtEVqsaIFM"}],"key":"QoqjHyaQ9t"}],"key":"aRCXt3r9KV"},{"type":"block","kind":"notebook-code","data":{"collapsed":true,"jupyter":{"outputs_hidden":true}},"children":[{"type":"code","lang":"python","executable":true,"value":"# We'll quickly create a new variable to use here\nresults['ppsf'] = results['price'] / results['size']","key":"rS6L9R1rYG"},{"type":"output","id":"cSrU93KRhXfSSBHz0fBKu","data":[],"key":"elboerWlVZ"}],"key":"ERuA4dvzi7"},{"type":"block","kind":"notebook-code","data":{"collapsed":false,"jupyter":{"outputs_hidden":false}},"children":[{"type":"code","lang":"python","executable":true,"value":"# These switches will turn on/off the KDE vs. histogram\nkws_dist = dict(kde=True, hist=False)\nn_loc = results['loc'].unique().shape[0]\nf, (ax_ppsf, ax_sze) = plt.subplots(1, 2, figsize=(10, 5))\nfor loc, vals in results.groupby('loc'):\n    sns.distplot(vals['ppsf'].dropna(), ax=ax_ppsf,\n                 bins=np.arange(0, 10, .5), label=loc, **kws_dist)\n    sns.distplot(vals['size'].dropna(), ax=ax_sze,\n                 bins=np.arange(0, 4000, 100), **kws_dist)\nax_ppsf.set(xlim=[0, 10], title='Price per square foot')\nax_sze.set(title='Size')","key":"eSzZ3BR9o4"},{"type":"output","id":"z5YeCJ_RK-4mYKoLEi9Yt","data":[{"output_type":"execute_result","execution_count":9,"metadata":{},"data":{"text/plain":{"content":"[&ltmatplotlib.text.Text at 0x114f59090&gt]","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"fdf3115b96d55361820a95699c96ec0f","path":"/build/fdf3115b96d55361820a95699c96ec0f.png"}}}],"key":"VLod6s5FIA"}],"key":"XAQt8h7kGW"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"So it looks like size-wise, there aren’t many differences here. However, with price per square foot, you’ll be paying a lot more for the same space in SF.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"s07w5jRpiL"}],"key":"FGkmGEu4MK"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Finally, let’s take a look at how the price scales with the size. For this, we’ll use a ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"VLQKiGfGsM"},{"type":"inlineCode","value":"regplot","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"GvMIWFd9ZB"},{"type":"text","value":" to fit a line to each distribution.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"fn72hYzWba"}],"key":"NkcJGpazvO"}],"key":"SkCKOW3k6H"},{"type":"block","kind":"notebook-code","data":{"collapsed":false,"jupyter":{"outputs_hidden":false}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Split up by location, then plot summaries of the data for each\nn_loc = results['loc'].unique().shape[0]\nf, axs = plt.subplots(n_loc, 3, figsize=(15, 5*n_loc))\nfor (loc, vals), (axr) in zip(results.groupby('loc'), axs):\n    sns.regplot('size', 'ppsf', data=vals, order=1, ax=axr[0])\n    sns.distplot(vals['ppsf'].dropna(), kde=True, ax=axr[1],\n                 bins=np.arange(0, 10, .5))\n    sns.distplot(vals['size'].dropna(), kde=True, ax=axr[2],\n                 bins=np.arange(0, 4000, 100))\n    axr[0].set_title('Location: {0}'.format(loc))\n\n_ = plt.setp(axs[:, 0], xlim=[0, 4000], ylim=[0, 10])\n_ = plt.setp(axs[:, 1], xlim=[0, 10], ylim=[0, 1])\n_ = plt.setp(axs[:, 2], xlim=[0, 4000], ylim=[0, .002])","key":"o2lyMPhX9I"},{"type":"output","id":"RSrOEx3WBwO2fZnu95Mlp","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"abedbd0e4a556d6f062819cb66b738ec","path":"/build/abedbd0e4a556d6f062819cb66b738ec.png"}}}],"key":"brbVWpL6Ju"}],"key":"pnKWp9Ph2T"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"And now on top of one another","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"p8cCqrkTg8"}],"key":"Td0HoEts70"}],"key":"jxR4iKrfxi"},{"type":"block","kind":"notebook-code","data":{"collapsed":false,"jupyter":{"outputs_hidden":false}},"children":[{"type":"code","lang":"python","executable":true,"value":"f, ax = plt.subplots()\nlocs = [res[0] for res in results.groupby('loc')]\nfor loc, vals in results.groupby('loc'):\n    sns.regplot('size', 'ppsf', data=vals, order=1, ax=ax,\n                scatter=True, label=loc, scatter_kws={'alpha':.3})\n\n# If we want to turn off the scatterplot\nscats = [isct for isct in ax.collections\n         if isinstance(isct, mpl.collections.PathCollection)]\n# plt.setp(scats, visible=False)\n\nax.legend(locs)\nax.set_xlim([0, 4000])\nax.set_ylim([0, 10])","key":"g0HELhxo3F"},{"type":"output","id":"iDvXQZk46Hls__bJFIvr6","data":[{"output_type":"execute_result","execution_count":11,"metadata":{},"data":{"text/plain":{"content":"(0, 10)","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"e8e093da1d3bc6ea067b0406b211450a","path":"/build/e8e093da1d3bc6ea067b0406b211450a.png"}}}],"key":"CFLSRQBEgt"}],"key":"nzw50JJovZ"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Basically, lines that go down more steeply mean you get a better deal the bigger the place is.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"miPuaIsGom"}],"key":"Xq2zOQWkyJ"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"For instance, if you’re in the southbay you might be paying $6/sqf for a 600 sq. ft. place, but $1/sqf for a 2000 sq. ft. place. On the other hand, San Francisco is pretty consistent, with a relatively flat line. This means that you’ll be paying pretty much the same per square foot regardless of how big your place is. In fact, all of the other regions seem to follow the same trend - so if you’re looking for more efficient big-place finds, go with the South Bay.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"MDYIlu5GbE"}],"key":"fTYlqRtmro"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Also note that this gives us information about the uncertainty in these estimates. The error bars are so wide for San Francisco because we don’t have many data points at high values (because there aren’t that many places >2000 square feet in SF). It’s anyone’s guess as to what this would cost.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"bIxtUTY1Ie"}],"key":"afnvE79Te7"}],"key":"Q0hRxN8ohq"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Text analysis","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"EIILQvhKEm"}],"identifier":"text-analysis","label":"Text analysis","html_id":"text-analysis","implicit":true,"key":"PPbFArp5oW"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Finally, we can also learn a bit from the text in the post titles. We could probably get better information by using the post text itself, but this would require some extra legwork looking up the URL of each entry and pulling the body of text from this. We’ll stick with titles for now.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"bpghtkJoop"}],"key":"oog8rej8xc"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"To do this, we’ll use some text analysis tools in ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"k3ciZqTfov"},{"type":"inlineCode","value":"scikit-learn","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"lfMqlRgD2X"},{"type":"text","value":". This is good enough for our purposes, though if we wanted to do something fancier we could use something like ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"BUXOrZirpl"},{"type":"inlineCode","value":"gensim","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"SFq7teQiIp"},{"type":"text","value":", ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"XkKybfoWS1"},{"type":"inlineCode","value":"word2vec","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"sp8hb36GGO"},{"type":"text","value":", or ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"CjERwYcEdW"},{"type":"inlineCode","value":"nltk","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"py3w6kef4Z"},{"type":"text","value":". (we’d also probably need a lot more data).","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"aYMnZeQQG9"}],"key":"pxHwGsshDu"}],"key":"M8zQO48FFu"},{"type":"block","kind":"notebook-code","data":{"collapsed":true,"jupyter":{"outputs_hidden":true}},"children":[{"type":"code","lang":"python","executable":true,"value":"from sklearn.feature_extraction.text import CountVectorizer\nfrom sklearn.preprocessing import LabelEncoder\nfrom sklearn.svm import LinearSVC\nfrom sklearn.cross_validation import StratifiedShuffleSplit\nfrom sklearn.feature_extraction.stop_words import ENGLISH_STOP_WORDS\nimport string","key":"XuQBSBQnWS"},{"type":"output","id":"HSLanePJj2fR4peNlYGMS","data":[],"key":"qrwz8k89gC"}],"key":"nEuyupRfxD"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"First we’ll do some quick data cleaning - we’ll only keep datapoints with a title, and then define some characters to remove so that the definition of “a word” makes more sense.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ZDKillsVcY"}],"key":"nq0AeIEQcf"}],"key":"b3Xn4lNuoH"},{"type":"block","kind":"notebook-code","data":{"collapsed":false,"jupyter":{"outputs_hidden":false}},"children":[{"type":"code","lang":"python","executable":true,"value":"word_data = results.dropna(subset=['title'])\n\n# Remove special characters\nrem = string.digits + '/\\-+.'\nrem_chars = lambda a: ''.join([i for i in a if i not in rem])\nword_data['title'] = word_data['title'].apply(rem_chars)","key":"uL18e07aLQ"},{"type":"output","id":"fTyPvXXROy2kdgsEr3_Hl","data":[],"key":"Y2KAJHdLTM"}],"key":"gCwgmU1FPg"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Next, we’ll remove words that are too specific (from a geographical standpoint) to the regions we’re using. Otherwise you’ll just get a bunch of clusters with streetnames etc. predicting the Bay Area region.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"l1DSumVxy6"}],"key":"nC3LNL86q0"}],"key":"eI4L22oqn9"},{"type":"block","kind":"notebook-code","data":{"collapsed":false,"jupyter":{"outputs_hidden":false}},"children":[{"type":"code","lang":"python","executable":true,"value":"loc_words = {'eby': ['antioch', 'berkeley', 'dublin', 'fremont', 'rockridge',\n                     'livermore', 'mercer', 'ramon'],\n             'nby': ['sausalito', 'marin', 'larkspur', 'novato', 'petaluma', 'bennett', \n                     'tiburon', 'sonoma', 'anselmo', 'healdsburg', 'rafael'],\n             'sby': ['campbell', 'clara', 'cupertino', 'jose'],\n             'scz': ['aptos', 'capitola', 'cruz', 'felton', 'scotts',\n                     'seabright', 'soquel', 'westside', 'ucsc'],\n             'sfc': ['miraloma', 'soma', 'usf', 'ashbury', 'marina',\n                     'mission', 'noe']}\n\n# We can append these to sklearn's collection of english \"stop\" words\nrand_words = ['th', 'xs', 'x', 'bd', 'ok', 'bdr']\nstop_words = [i for j in loc_words.values() for i in j] + rand_words\nstop_words = ENGLISH_STOP_WORDS.union(stop_words)","key":"RFILi3mUHl"},{"type":"output","id":"LJae0kiuWN4cMV7vCxQ1U","data":[],"key":"M1FSgRj23a"}],"key":"tcdJ09Fi69"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Finally, we will vectorize this data so that it can be used with sklearn algorithms. This takes a list of “bags” of words, and turns it into a list of vectors, where the length of each vector is the total number of words we’ve got. Each position of the vector corresponds to 1 word. It will be “1” if that word is present in the current item, and 0 otherwise:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"RcSWRbW2mT"}],"key":"xJ8CZHBCfB"}],"key":"K6ZSxux2l6"},{"type":"block","kind":"notebook-code","data":{"collapsed":false,"jupyter":{"outputs_hidden":false}},"children":[{"type":"code","lang":"python","executable":true,"value":"vec = CountVectorizer(max_df=.6, stop_words=stop_words)\nvec_tar = LabelEncoder()\n\ncounts = vec.fit_transform(word_data['title'])\ntargets = vec_tar.fit_transform(word_data['loc'])\nplt.plot(counts[:3].toarray().T)\nplt.ylim([-1, 2])\nplt.title('Each row is a post, with 1s representing presence of a word in that post')","key":"tWFstywvBc"},{"type":"output","id":"-KG017FmmwWcrWj-9gHLG","data":[{"output_type":"execute_result","execution_count":15,"metadata":{},"data":{}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"27ea327c670ab1dd8ffa84cea06f5a44","path":"/build/27ea327c670ab1dd8ffa84cea06f5a44.png"}}}],"key":"ymOs8OB70c"}],"key":"QQNpN1JQck"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Let’s do a quick description of the most common words in each region. We can use our vectorized vocabulary and see which words were most common.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"FrlNiEl0EO"}],"key":"IqvGaOWWBc"}],"key":"I6af3Uw7EL"},{"type":"block","kind":"notebook-code","data":{"collapsed":false,"jupyter":{"outputs_hidden":false}},"children":[{"type":"code","lang":"python","executable":true,"value":"top_words = {}\nfor itrg in np.unique(targets):\n    loc = vec_tar.classes_[itrg]\n    # Pull only the data points assigned to the current loction\n    icounts = counts[targets == itrg, :].sum(0).squeeze()\n    \n    # Which counts had at least five occurrences\n    msk_top_words = icounts > 5\n    \n    # The inverse transform turns the vectors back into actual words\n    top_words[loc] = vec.inverse_transform(msk_top_words)[0]","key":"Dd0USI8sOb"},{"type":"output","id":"Qe8tBmQfULysSpbE8XcN8","data":[],"key":"ArldYvmBjL"}],"key":"wIuRpr5ROp"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Then, we’ll print the words that are unique to each area by filtering out ones that are common across locations:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"P3VoNYI3WH"}],"key":"vm370HSYrL"}],"key":"P3tob2ke9U"},{"type":"block","kind":"notebook-code","data":{"collapsed":false,"jupyter":{"outputs_hidden":false}},"children":[{"type":"code","lang":"python","executable":true,"value":"unique_words = {}\nfor loc, words in top_words.iteritems():\n    others = top_words.copy()\n    others.pop(loc)\n    unique_words[loc] = [wrd for wrd in top_words[loc]\n                         if wrd not in np.hstack(others.values())]\nfor loc, words in unique_words.iteritems():\n    print('{0}: {1}\\n\\n---\\n'.format(loc, words))","key":"vrZs3tXyS7"},{"type":"output","id":"hn8osXWp082EPx0gm1YaK","data":[],"key":"xuSguSA9Rw"}],"key":"oN2hOtH569"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Apparently people in the North Bay like appliances, people in Santa Cruz like the beach, people in the East Bay need the Bart, and people in San Francisco have victorians...who knew.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"mBilrDZ2EO"}],"key":"UqaIrFLT8a"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Just for fun we’ll also do a quick classification algorithm to see if some machine learning can find structure in these words that separates one location from another:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"u5ZkTF4zDU"}],"key":"hv9qsDQlU3"}],"key":"azmIwTSYzW"},{"type":"block","kind":"notebook-code","data":{"collapsed":false,"jupyter":{"outputs_hidden":false}},"children":[{"type":"code","lang":"python","executable":true,"value":"mod = LinearSVC(C=.1)\ncv = StratifiedShuffleSplit(targets, n_iter=10, test_size=.2)\n\ncoefs = []\nfor tr, tt in cv:\n    mod.fit(counts[tr], targets[tr])\n    coefs.append(mod.coef_)\n    print(mod.score(counts[tt], targets[tt]))\ncoefs = np.array(coefs).mean(0)","key":"NFff6laRwK"},{"type":"output","id":"w8cXLOdJFfiTkwH9rXiz3","data":[],"key":"aclUnjcQ0w"}],"key":"mUL9Khy7Ly"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Doesn’t look like it (those are horrible generalization scores), but we’ll look at what coefficients it considered important anyway:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VsBOHojcwe"}],"key":"Dg4F9DVnKE"}],"key":"l4G6hX876G"},{"type":"block","kind":"notebook-code","data":{"collapsed":false,"jupyter":{"outputs_hidden":false}},"children":[{"type":"code","lang":"python","executable":true,"value":"for loc, icoef in zip(vec_tar.classes_, coefs):\n    cut = np.percentile(icoef, 99)\n    important = icoef > cut\n    print('{0}: {1}'.format(loc, vec.inverse_transform(important)))","key":"HyzG8tTEVW"},{"type":"output","id":"YF0vDngsxj7_1_T2fWMLr","data":[],"key":"SKJsFkxRNs"}],"key":"hWH0Ud3ens"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"You may note that these are quite similar to the words that were unique to each location as noted above - such is the power of machine learning :)","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"AwE8nhfMb7"}],"key":"jjEf4stad0"}],"key":"aUPwIAfQU1"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"So what have we learned?","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"hhgi8xNWod"}],"identifier":"so-what-have-we-learned","label":"So what have we learned?","html_id":"so-what-have-we-learned","implicit":true,"key":"fXygbaWLxt"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Well, you might say that we’ve merely quantified what everybody already knows: San Francisco is expensive, really expensive. If you’re looking for a place in the Bay Area, you can expect to shell out a lot more for the same square footage.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"FGe3sdpNSh"}],"key":"Zwpy2yB1bB"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"However, what’s also interesting is that apartments in the Bay Area don’t seem to obey the same rules that other regions do - they don’t necessarily become more economically efficient as the place gets bigger. This is in stark contrast to the south bay, where places are pretty expensive in general, but in ways that you’d expect for an apartment.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"TElJpiUM6I"}],"key":"Qgqjkn9ESW"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Finally, there are probably lots of other cool things that you could do with these datasets, especially if you wanted to break things down by neighborhood and collect more data.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"AZbg01WgNC"}],"key":"hBFSywsYd3"}],"key":"tYV8OFg4ab"}],"key":"YhafzRTpBX"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Scraping craigslist","url":"/blog/2015/2015-08-30-craigslist-scrape","group":"2015"},"next":{"title":"NIH grant analysis","url":"/blog/2015/2015-10-29-nih-grant-analysis","group":"2015"}}},"domain":"http://localhost:3000"}