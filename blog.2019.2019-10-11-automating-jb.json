{"version":2,"kind":"Article","sha256":"4cf15a19babdb3ad67dc2a0c5fda756ed81b3dd897b69ce1f2dd6775fe4ceac9","slug":"blog.2019.2019-10-11-automating-jb","location":"/blog/2019/2019-10-11-automating-jb.md","dependencies":[],"frontmatter":{"title":"Automating Jupyter Book deployments with CI/CD","tags":["infrastructure"],"date":"2019-10-11","content_includes_title":false,"authors":[{"id":"chris","nameParsed":{"literal":"Chris Holdgraf","given":"Chris","family":"Holdgraf"},"name":"Chris Holdgraf","orcid":"0000-0002-2391-0678","affiliations":["affiliations-myst-generated-uid-0","affiliations-myst-generated-uid-1"],"url":"https://chrisholdgraf.com","github":"choldgraf","twitter":"choldgraf"}],"github":"https://github.com/choldgraf/choldgraf.github.io","affiliations":[{"name":"2i2c","url":"https://2i2c.org","id":"affiliations-myst-generated-uid-0"},{"name":"Project Jupyter","url":"https://jupyter.org","id":"affiliations-myst-generated-uid-1"}],"abbreviations":{"LF":"The Linux Foundation","JF":"The Jupyter Foundation","JEC":"Jupyter Executive Council","JFB":"The Jupyter Foundation Board","SSC":"Software Steering Council","OSPO":"Open Source Program Office"},"numbering":{"title":{"offset":2}},"source_url":"https://github.com/choldgraf/choldgraf.github.io/blob/main/blog/2019/2019-10-11-automating-jb.md","edit_url":"https://github.com/choldgraf/choldgraf.github.io/edit/main/blog/2019/2019-10-11-automating-jb.md","thumbnail":"/build/jb-auto-build-2f273bc5f12086452094ca8c20513cf7.png","exports":[{"format":"md","filename":"2019-10-11-automating-jb.md","url":"/build/2019-10-11-automatin-c287036fe7ece044173ff1848c51c30e.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":10,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"Lately I’ve spent a lot of time trying to reduce the friction involved\nin deploying Jupyter Book as well as contributing to the project.\nFeatures are a great carrot, but ultimately getting engagement is also\nabout lowering barriers to entry and showing people a path forward.\nJupyter Book is a relatively straightforward project, but it involves\na few technical pieces that can be painful to use (thanks Jekyll).","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"zhBPBtPy5j"}],"key":"CaQnVKB423"},{"type":"paragraph","position":{"start":{"line":17,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"Recently I experimented with whether we can ","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"agDNqYiZf3"},{"type":"strong","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"automate deploying a Jupyter Book online","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"IocRGInt7e"}],"key":"KuRr4yAOf3"},{"type":"text","value":".\nUsing continuous integration / deployment services seems like a natural place\nto try this out. One can upload a barebones set of code to a GitHub repository,\nthen configure a build system to create a book and deploy it online from there.\nThis blog post is a place to keep track of the current state of affairs for this workflow.","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"JDLq3FavsW"}],"key":"G1JAPxg9Ap"},{"type":"image","url":"/build/jb-auto-build-2f273bc5f12086452094ca8c20513cf7.png","alt":"auto build logos","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"uuu9gyXpkI","urlSource":"../../images/2019/jb-auto-build.png"},{"type":"paragraph","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"strong","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"text","value":"I’ll publish the latest configuration files for this at ","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"clmc272vFG"},{"type":"link","url":"https://github.com/choldgraf/jupyter-book-deploy-demo/","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"text","value":"this repository","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"CNwbXpjuh2"}],"urlSource":"https://github.com/choldgraf/jupyter-book-deploy-demo/","error":true,"key":"xAfYrI87sJ"}],"key":"UmGBjokSn2"},{"type":"text","value":".","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"mQpNDJ2NfV"}],"key":"VlRArYtguU"},{"type":"heading","depth":2,"position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"text","value":"The general set of steps involved","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"t7FKgIbKKP"}],"identifier":"the-general-set-of-steps-involved","label":"The general set of steps involved","html_id":"the-general-set-of-steps-involved","implicit":true,"key":"Gr3O8TZDqs"},{"type":"paragraph","position":{"start":{"line":29,"column":1},"end":{"line":31,"column":1}},"children":[{"type":"text","value":"We’ll start with the simplest possible Jupyter Book configuration:\nto have a single folder with a collection of content inside. The folder looks\nlike this:","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"o1NaRUidBd"}],"key":"FXHdKmuJTW"},{"type":"code","lang":"bash","value":".\n├── content\n│   ├── 01\n|   │   ├──── notebook1.ipynb\n│   │   └──── notebook2.ipynb\n│   ├── 02\n|   │   ├──── notebook3.ipynb\n│   │   └──── mdfile4.md\n...\n|\n└── configuration_files_for_cicd/","position":{"start":{"line":33,"column":1},"end":{"line":45,"column":1}},"key":"TiceaqefhS"},{"type":"paragraph","position":{"start":{"line":47,"column":1},"end":{"line":49,"column":1}},"children":[{"type":"text","value":"There’s no table of contents, and no configuration file (though we could add\nthese if we wish). If Jupyter Book is used to create a new book with some\ncontent, but no TOC is given, it’ll automatically generate one.","position":{"start":{"line":47,"column":1},"end":{"line":47,"column":1}},"key":"exh2cjucdw"}],"key":"nB13Enb80O"},{"type":"paragraph","position":{"start":{"line":51,"column":1},"end":{"line":51,"column":1}},"children":[{"type":"text","value":"Our goal is to do the following in an automated fashion:","position":{"start":{"line":51,"column":1},"end":{"line":51,"column":1}},"key":"dMP2lWdxon"}],"key":"DgfPVbN4fp"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":53,"column":1},"end":{"line":57,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Build a new Jupyter Book template from this content folder (with ","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"key":"DU6xUB7Ief"},{"type":"inlineCode","value":"jupyter-book create","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"key":"t9tUZbjNFC"},{"type":"text","value":")","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"key":"OeCwTIWVRZ"}],"key":"r5r6Rc6bz8"}],"key":"Q1wVcsmXdd"},{"type":"listItem","spread":true,"position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Build page HTML for the book (with ","position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"key":"qHBIAtSoTJ"},{"type":"inlineCode","value":"jupyter-book build","position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"key":"xdtLBRd6Rr"},{"type":"text","value":")","position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"key":"Nm5CNYSfwv"}],"key":"tOktnFNzBM"}],"key":"Pviys5qXCV"},{"type":"listItem","spread":true,"position":{"start":{"line":55,"column":1},"end":{"line":55,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Generate the book’s site with Jekyll (with ","position":{"start":{"line":55,"column":1},"end":{"line":55,"column":1}},"key":"Ipd6xHPk7u"},{"type":"inlineCode","value":"bundle exec jekyll build","position":{"start":{"line":55,"column":1},"end":{"line":55,"column":1}},"key":"or9n1z1a4t"},{"type":"text","value":")","position":{"start":{"line":55,"column":1},"end":{"line":55,"column":1}},"key":"if9QxIN170"}],"key":"RbUnoPt0KF"}],"key":"NmShQi3Miw"},{"type":"listItem","spread":true,"position":{"start":{"line":56,"column":1},"end":{"line":57,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Host the results somewhere online","position":{"start":{"line":56,"column":1},"end":{"line":56,"column":1}},"key":"vG8RNDQCXa"}],"key":"WvHu15kRSu"}],"key":"KIE5RY3XG2"}],"key":"OmmaaxjHAy"},{"type":"paragraph","position":{"start":{"line":58,"column":1},"end":{"line":60,"column":1}},"children":[{"type":"text","value":"Below are attempts to do this with CI/CD. I’ll update this post\nas new options become available (and hopefully push some stuff to\nthe Jupyter Book documentation).","position":{"start":{"line":58,"column":1},"end":{"line":58,"column":1}},"key":"w1dHOosj5l"}],"key":"dhfYFMp701"},{"type":"heading","depth":2,"position":{"start":{"line":62,"column":1},"end":{"line":62,"column":1}},"children":[{"type":"text","value":"Netlify","position":{"start":{"line":62,"column":1},"end":{"line":62,"column":1}},"key":"kQH5oulNnD"}],"identifier":"netlify","label":"Netlify","html_id":"netlify","implicit":true,"key":"weZIND7NAB"},{"type":"paragraph","position":{"start":{"line":64,"column":1},"end":{"line":68,"column":1}},"children":[{"type":"text","value":"By far the easiest way to accomplish the above is with the online\nwebsite provider ","position":{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},"key":"KnXgC3LCrB"},{"type":"link","url":"https://www.netlify.com","position":{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},"children":[{"type":"text","value":"Netlify","position":{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},"key":"pKVG4YfR47"}],"urlSource":"https://www.netlify.com","key":"zJB7vQWcna"},{"type":"text","value":". This was my\nfirst experience with the Netlify service, and I must say that I was\nreally pleased (thanks to ","position":{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},"key":"dngmAs9dC9"},{"type":"link","url":"https://github.com/emdupre","position":{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},"children":[{"type":"text","value":"Elizabeth DuPre","position":{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},"key":"kwSG6PVOUc"}],"urlSource":"https://github.com/emdupre","error":true,"key":"QGv9IZO7Ik"},{"type":"text","value":"\nfor the recommendation and ","position":{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},"key":"Sx9FQJ1osI"},{"type":"link","url":"https://jupyterbook.org/guide/publish/netlify.html","position":{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},"children":[{"type":"text","value":"Netlify tutorial","position":{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},"key":"yNv1vz8nOl"}],"urlSource":"https://jupyterbook.org/guide/publish/netlify.html","key":"tfsEaXHgou"},{"type":"text","value":").","position":{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},"key":"UDnV1W1lW4"}],"key":"Wd6ZUGFq0a"},{"type":"paragraph","position":{"start":{"line":70,"column":1},"end":{"line":73,"column":1}},"children":[{"type":"text","value":"Netlify has automatic deployment built into its service, since that’s\nthe whole point of the site - to deploy websites from online repositories.\nTo do this, I simply had to connect Netlify to my ","position":{"start":{"line":70,"column":1},"end":{"line":70,"column":1}},"key":"osiKpxHUUY"},{"type":"link","url":"https://github.com/choldgraf/jupyter-book-deploy-demo/","position":{"start":{"line":70,"column":1},"end":{"line":70,"column":1}},"children":[{"type":"text","value":"book content repository","position":{"start":{"line":70,"column":1},"end":{"line":70,"column":1}},"key":"msGC9OUq3T"}],"urlSource":"https://github.com/choldgraf/jupyter-book-deploy-demo/","error":true,"key":"fXSv3kDeHO"},{"type":"text","value":"\nand tell it to start building a site from that repository’s contents.","position":{"start":{"line":70,"column":1},"end":{"line":70,"column":1}},"key":"HKTcgOXNpj"}],"key":"SAyDaj7IO7"},{"type":"paragraph","position":{"start":{"line":75,"column":1},"end":{"line":78,"column":1}},"children":[{"type":"text","value":"I modified the build instructions using a custom “build” command.\nNetlify runs this command every time it tries to build your site.\nYou can configure this by creating a ","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"key":"JaAFmAoIQ7"},{"type":"inlineCode","value":"netlify.toml","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"key":"Asyrj1qY8i"},{"type":"text","value":" file and putting it\nin the root of your repository. ","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"key":"OuWZKM62q7"},{"type":"link","url":"https://github.com/choldgraf/jupyter-book-deploy-demo/blob/master/netlify.toml","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"children":[{"type":"text","value":"Here’s a link to my configuration file","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"key":"GyK9rduhlT"}],"urlSource":"https://github.com/choldgraf/jupyter-book-deploy-demo/blob/master/netlify.toml","data":{"kind":"file","org":"choldgraf","repo":"jupyter-book-deploy-demo","reference":"master","file":"netlify.toml","raw":"https://raw.githubusercontent.com/choldgraf/jupyter-book-deploy-demo/master/netlify.toml"},"internal":false,"protocol":"github","key":"Buu90Z0Yke"},{"type":"text","value":".","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"key":"sDLWLfNddh"}],"key":"sWPBvgpDJv"},{"type":"paragraph","position":{"start":{"line":80,"column":1},"end":{"line":80,"column":1}},"children":[{"type":"text","value":"The full text of that TOML file looks like this:","position":{"start":{"line":80,"column":1},"end":{"line":80,"column":1}},"key":"my49jXRO0K"}],"key":"ut8SGpHPVK"},{"type":"code","lang":"toml","value":"[build]\n  command = \"\"\"\n    gem install bundler -v '2.0.2'\n    pip install -U git+https://github.com/jupyter/jupyter-book\n    jupyter-book create mybook --content-folder content\n    cd mybook\n    jupyter-book build ./ --overwrite\n    make install\n    bundle exec jekyll build\n    \"\"\"\n\n  publish = \"mybook/_site\"","position":{"start":{"line":82,"column":1},"end":{"line":95,"column":1}},"key":"z5vxDxV4hy"},{"type":"paragraph","position":{"start":{"line":97,"column":1},"end":{"line":99,"column":1}},"children":[{"type":"text","value":"There are two pieces to this: the ","position":{"start":{"line":97,"column":1},"end":{"line":97,"column":1}},"key":"TAmR9jI1FP"},{"type":"inlineCode","value":"command","position":{"start":{"line":97,"column":1},"end":{"line":97,"column":1}},"key":"bPFrAC0bnY"},{"type":"text","value":" section is the command to\nrun first, when a new commit is pushed to a branch. The ","position":{"start":{"line":97,"column":1},"end":{"line":97,"column":1}},"key":"o3AC9SoXzB"},{"type":"inlineCode","value":"publish","position":{"start":{"line":97,"column":1},"end":{"line":97,"column":1}},"key":"DITPSOhhdN"},{"type":"text","value":" section\ndefines the location where Netlify will look for the finished HTML (AKA, my book website).","position":{"start":{"line":97,"column":1},"end":{"line":97,"column":1}},"key":"APSXi0QYfk"}],"key":"Bg09gaJVOP"},{"type":"paragraph","position":{"start":{"line":101,"column":1},"end":{"line":104,"column":1}},"children":[{"type":"text","value":"Note that in the ","position":{"start":{"line":101,"column":1},"end":{"line":101,"column":1}},"key":"F7OYYWCRA6"},{"type":"inlineCode","value":"jupyter-book create","position":{"start":{"line":101,"column":1},"end":{"line":101,"column":1}},"key":"Zaur8CKwTY"},{"type":"text","value":" command above, I used ","position":{"start":{"line":101,"column":1},"end":{"line":101,"column":1}},"key":"eqYTa9DO2E"},{"type":"inlineCode","value":"--content-folder","position":{"start":{"line":101,"column":1},"end":{"line":101,"column":1}},"key":"YWgHasVYfd"},{"type":"text","value":" to\ntell Jupyter Book to use some pre-existing content when it generated my book template.\nIn addition, note that I could immediately install both Python and Ruby packages - that’s\nbecause Netlify’s base build environment has both languages installed already!","position":{"start":{"line":101,"column":1},"end":{"line":101,"column":1}},"key":"asH7CjGjjH"}],"key":"l8v6roMxgN"},{"type":"comment","value":" #region {\"tags\": [\"popout\"]} ","key":"tpPeQnElhu"},{"type":"paragraph","position":{"start":{"line":107,"column":1},"end":{"line":108,"column":1}},"children":[{"type":"text","value":"One gotcha on getting Netlify to work was configuring it to use a Python 3.X environment.\nThat’s accomplished with the ","position":{"start":{"line":107,"column":1},"end":{"line":107,"column":1}},"key":"BOSVcP4kXR"},{"type":"inlineCode","value":"runtime.txt","position":{"start":{"line":107,"column":1},"end":{"line":107,"column":1}},"key":"k3HiPImgru"},{"type":"text","value":" file ","position":{"start":{"line":107,"column":1},"end":{"line":107,"column":1}},"key":"AXJTB0mNzz"},{"type":"link","url":"https://github.com/choldgraf/jupyter-book-deploy-demo/blob/master/runtime.txt","position":{"start":{"line":107,"column":1},"end":{"line":107,"column":1}},"children":[{"type":"text","value":"at this location","position":{"start":{"line":107,"column":1},"end":{"line":107,"column":1}},"key":"DwB3WTnpL9"}],"urlSource":"https://github.com/choldgraf/jupyter-book-deploy-demo/blob/master/runtime.txt","data":{"kind":"file","org":"choldgraf","repo":"jupyter-book-deploy-demo","reference":"master","file":"runtime.txt","raw":"https://raw.githubusercontent.com/choldgraf/jupyter-book-deploy-demo/master/runtime.txt"},"internal":false,"protocol":"github","key":"P2yzXXanwa"},{"type":"text","value":".","position":{"start":{"line":107,"column":1},"end":{"line":107,"column":1}},"key":"qREdsse11p"}],"key":"E2UsQgVivQ"},{"type":"comment","value":" #endregion ","key":"DLALC8vuJn"},{"type":"paragraph","position":{"start":{"line":111,"column":1},"end":{"line":112,"column":1}},"children":[{"type":"text","value":"By adding this configuration to my site, Netlify immediately started building\nand hosting the book. You can find ","position":{"start":{"line":111,"column":1},"end":{"line":111,"column":1}},"key":"dWV7r0Zt0U"},{"type":"link","url":"https://jupyter-book-deploy-demo.netlify.com","position":{"start":{"line":111,"column":1},"end":{"line":111,"column":1}},"children":[{"type":"text","value":"that book deployment here","position":{"start":{"line":111,"column":1},"end":{"line":111,"column":1}},"key":"RTBObAZxUp"}],"urlSource":"https://jupyter-book-deploy-demo.netlify.com","key":"kp11ZjMDAs"},{"type":"text","value":".","position":{"start":{"line":111,"column":1},"end":{"line":111,"column":1}},"key":"heT5xF0B3s"}],"key":"pTn22D1CuL"},{"type":"heading","depth":2,"position":{"start":{"line":114,"column":1},"end":{"line":114,"column":1}},"children":[{"type":"text","value":"CircleCI","position":{"start":{"line":114,"column":1},"end":{"line":114,"column":1}},"key":"mN49NEvJ2e"}],"identifier":"circleci","label":"CircleCI","html_id":"circleci","implicit":true,"key":"IZHvXDxmLX"},{"type":"paragraph","position":{"start":{"line":116,"column":1},"end":{"line":118,"column":1}},"children":[{"type":"link","url":"https://circleci.com","position":{"start":{"line":116,"column":1},"end":{"line":116,"column":1}},"children":[{"type":"text","value":"CircleCI","position":{"start":{"line":116,"column":1},"end":{"line":116,"column":1}},"key":"yqs3XxQ4Hj"}],"urlSource":"https://circleci.com","key":"dX3JqHcX9l"},{"type":"text","value":" is a website most-commonly used for running\ntest suites and deploying things into production once those tests pass.\nFortunately, deploying an HTML book is pretty similar!","position":{"start":{"line":116,"column":1},"end":{"line":116,"column":1}},"key":"NTx6IdCxxt"}],"key":"tzvUz2pEs9"},{"type":"paragraph","position":{"start":{"line":120,"column":1},"end":{"line":121,"column":1}},"children":[{"type":"text","value":"Getting Jupyter Book to build on CircleCI was a little bit trickier for two\nreasons:","position":{"start":{"line":120,"column":1},"end":{"line":120,"column":1}},"key":"LmtiPwANdp"}],"key":"zjkKDTkpdh"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":123,"column":1},"end":{"line":127,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":123,"column":1},"end":{"line":124,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"CircleCI has more specific environments in its build system. You can have a Python\nenvironment, or a Ruby environment, but not both.","position":{"start":{"line":123,"column":1},"end":{"line":123,"column":1}},"key":"OwDV3uKCc0"}],"key":"sjvfnHsbRF"}],"key":"gOgIZIaV2T"},{"type":"listItem","spread":true,"position":{"start":{"line":125,"column":1},"end":{"line":127,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"CircleCI has no concept of natively “hosting” HTML content, so we had to piggy-back\non top of GitHub pages.","position":{"start":{"line":125,"column":1},"end":{"line":125,"column":1}},"key":"W3MJR3W66F"}],"key":"lBjOKHW1iT"}],"key":"ee66w0OozM"}],"key":"GGgKilu868"},{"type":"paragraph","position":{"start":{"line":128,"column":1},"end":{"line":129,"column":1}},"children":[{"type":"text","value":"Luckily, working around both of these issues was relatively straightforward.\nYou can find the CircleCI configuration that ended up working ","position":{"start":{"line":128,"column":1},"end":{"line":128,"column":1}},"key":"RQIcd1CMEO"},{"type":"link","url":"https://github.com/choldgraf/jupyter-book-deploy-demo/blob/master/.circleci/config.yml","position":{"start":{"line":128,"column":1},"end":{"line":128,"column":1}},"children":[{"type":"text","value":"in the github repository","position":{"start":{"line":128,"column":1},"end":{"line":128,"column":1}},"key":"XcSpicl7Qj"}],"urlSource":"https://github.com/choldgraf/jupyter-book-deploy-demo/blob/master/.circleci/config.yml","data":{"kind":"file","org":"choldgraf","repo":"jupyter-book-deploy-demo","reference":"master","file":".circleci/config.yml","raw":"https://raw.githubusercontent.com/choldgraf/jupyter-book-deploy-demo/master/.circleci/config.yml"},"internal":false,"protocol":"github","key":"FI6dVHf1fA"},{"type":"text","value":".","position":{"start":{"line":128,"column":1},"end":{"line":128,"column":1}},"key":"sDfBSGoWtJ"}],"key":"Ik127ovtRO"},{"type":"paragraph","position":{"start":{"line":131,"column":1},"end":{"line":131,"column":1}},"children":[{"type":"text","value":"There were two gotchas in there:","position":{"start":{"line":131,"column":1},"end":{"line":131,"column":1}},"key":"Biyl5NrHf7"}],"key":"nQZO5IJSTv"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":133,"column":1},"end":{"line":139,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":133,"column":1},"end":{"line":136,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"I started off with using a Ruby environment rather than a Python environment.\nThat’s becuase I’ve found Python to be much easier to install than Ruby. In fact,\ninstalling python was as easy as including ","position":{"start":{"line":133,"column":1},"end":{"line":133,"column":1}},"key":"k00o6KrIU8"},{"type":"inlineCode","value":"sudo apt-get install python3-pip","position":{"start":{"line":133,"column":1},"end":{"line":133,"column":1}},"key":"L8nnLkzha3"},{"type":"text","value":" in\nmy commands.","position":{"start":{"line":133,"column":1},"end":{"line":133,"column":1}},"key":"JIV2T9rAQ3"}],"key":"RWorWpawkS"}],"key":"UXlYFBGRQD"},{"type":"listItem","spread":true,"position":{"start":{"line":137,"column":1},"end":{"line":139,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"I had to use a GitHub SSH deploy key to be able to deploy my built HTML to GitHub\npages. You can find ","position":{"start":{"line":137,"column":1},"end":{"line":137,"column":1}},"key":"Si6ntmoRbc"},{"type":"link","url":"https://chrisholdgraf.com/circleci-mirror","position":{"start":{"line":137,"column":1},"end":{"line":137,"column":1}},"children":[{"type":"text","value":"instructions for how to do so in this post","position":{"start":{"line":137,"column":1},"end":{"line":137,"column":1}},"key":"ncnBOyjfbT"}],"urlSource":"https://chrisholdgraf.com/circleci-mirror","key":"XUpf6TiVga"},{"type":"text","value":".","position":{"start":{"line":137,"column":1},"end":{"line":137,"column":1}},"key":"bCtn3lhmv9"}],"key":"FdYh0p31pe"}],"key":"C0VzvWKCRW"}],"key":"miJWjWrT1G"},{"type":"paragraph","position":{"start":{"line":140,"column":1},"end":{"line":140,"column":1}},"children":[{"type":"text","value":"Once that was accomplished, this is the configuration that got the job done:","position":{"start":{"line":140,"column":1},"end":{"line":140,"column":1}},"key":"LRTozDbQ75"}],"key":"O3jve4EJ2B"},{"type":"code","lang":"yaml","value":"version: 2.1\njobs:\n  build_book:\n    docker:\n      - image: circleci/ruby:2.6\n    steps:\n      - checkout\n      - run:\n          name: Install Python and dependencies to build page HTML\n          command: |\n            sudo apt-get install python3-pip\n            pip3 install --user -r requirements.txt\n            pip3 install --user -U git+https://github.com/jupyter/jupyter-book.git\n\n      - run:\n          name: Create book template and build page HTML\n          command: |\n            jupyter-book create mybook --content-folder content/\n            jupyter-book build ./mybook\n\n      - run:\n          name: Install ruby dependencies and build the book's website\n          command: |\n            cd mybook\n            make install\n            bundle exec jekyll build\n\n      # If we're on master, push to a gh-pages branch\n      - add_ssh_keys:\n          fingerprints:\n            - \"<my-public-fingerprint>\"\n      - run:\n          name: Push to gh-pages (if on master)\n          command: |\n            if [ $CIRCLE_BRANCH\t== \"master\" ]; then\n              pip3 install ghp-import\n              ghp-import -n -f -p mybook/_site;\n            else\n              echo \"Skipping deploy because we aren't on master\"\n            fi\n\n\nworkflows:\n  version: 2\n  default:\n    jobs:\n      - build_book","position":{"start":{"line":142,"column":1},"end":{"line":190,"column":1}},"key":"Ec5x9ud32F"},{"type":"paragraph","position":{"start":{"line":192,"column":1},"end":{"line":192,"column":1}},"children":[{"type":"text","value":"You can find the deployed site ","position":{"start":{"line":192,"column":1},"end":{"line":192,"column":1}},"key":"zMYwoh9PZj"},{"type":"link","url":"https://github.com/choldgraf/jupyter-book-deploy-demo","position":{"start":{"line":192,"column":1},"end":{"line":192,"column":1}},"children":[{"type":"text","value":"at this location","position":{"start":{"line":192,"column":1},"end":{"line":192,"column":1}},"key":"dT0BxQBBRo"}],"urlSource":"https://github.com/choldgraf/jupyter-book-deploy-demo","error":true,"key":"PtZ6f7V9t5"},{"type":"text","value":".","position":{"start":{"line":192,"column":1},"end":{"line":192,"column":1}},"key":"dfmAtoa7Xs"}],"key":"jm11TZTGOs"},{"type":"heading","depth":2,"position":{"start":{"line":194,"column":1},"end":{"line":194,"column":1}},"children":[{"type":"text","value":"Wrapping up","position":{"start":{"line":194,"column":1},"end":{"line":194,"column":1}},"key":"MGUFr0KXrf"}],"identifier":"wrapping-up","label":"Wrapping up","html_id":"wrapping-up","implicit":true,"key":"VPfnRAHQHn"},{"type":"paragraph","position":{"start":{"line":196,"column":1},"end":{"line":198,"column":1}},"children":[{"type":"text","value":"Ultimately, it was simpler than I expected to deploy a Jupyter Book with CI/CD.\nThere are lots of other services to explore (in particular, TravisCI and GitHub actions),\nbut I find it hard to believe anything would be more straightforward than Netlify.","position":{"start":{"line":196,"column":1},"end":{"line":196,"column":1}},"key":"rDVH9sZErG"}],"key":"m4hryBD966"},{"type":"paragraph","position":{"start":{"line":200,"column":1},"end":{"line":203,"column":1}},"children":[{"type":"text","value":"That said, the process also made it clear that some pieces of the Jupyter Book API\nare a bit confusing. It felt natural to have my content in a single folder, and to\nbuild a book from that content, but this isn’t the “default” way that the documentation\nrecommends. I’ll let these ideas simmer a little bit and we’ll see what comes out of it.","position":{"start":{"line":200,"column":1},"end":{"line":200,"column":1}},"key":"Wz03IOUssl"}],"key":"AqAZzfuYsw"}],"key":"RIjaCyF72b"}],"key":"sFO8zrtmpO"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"A few recent talks","url":"/blog/2019/2019-06-25-a-few-talks","group":"2019"},"next":{"title":"What would Rust-style governance look like in Jupyter?","url":"/blog/2019/2019-10-13-rust-jupyter-governance","group":"2019"}}},"domain":"http://localhost:3000"}