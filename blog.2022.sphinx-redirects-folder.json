{"version":1,"kind":"Article","sha256":"42b41f2badfc7a6371a0b74523ece53ffd34490520fdc363176e155d90574fbf","slug":"blog.2022.sphinx-redirects-folder","location":"/blog/2022/sphinx-redirects-folder.md","dependencies":[],"frontmatter":{"title":"Automatically redirect folders in Sphinx websites","date":"2022-11-19","content_includes_title":false,"authors":[{"id":"chris","nameParsed":{"literal":"Chris Holdgraf","given":"Chris","family":"Holdgraf"},"name":"Chris Holdgraf","orcid":"0000-0002-2391-0678","affiliations":["affiliations-myst-generated-uid-0","affiliations-myst-generated-uid-1"],"twitter":"choldgraf","github":"choldgraf","url":"https://chrisholdgraf.com"}],"github":"https://github.com/choldgraf/choldgraf.github.io","affiliations":[{"name":"2i2c","url":"https://2i2c.org","id":"affiliations-myst-generated-uid-0"},{"name":"Project Jupyter","url":"https://jupyter.org","id":"affiliations-myst-generated-uid-1"}],"abbreviations":{"LF":"The Linux Foundation","JF":"The Jupyter Foundation","JEC":"Jupyter Executive Council","JFB":"The Jupyter Foundation Board","SSC":"Software Steering Council","OSPO":"Open Source Program Office"},"numbering":{"title":{"offset":2}},"edit_url":"https://github.com/choldgraf/choldgraf.github.io/blob/main/blog/2022/sphinx-redirects-folder.md","exports":[{"format":"md","filename":"sphinx-redirects-folder.md","url":"/build/sphinx-redirects-fol-26b8ed5321c920e0fbac381ca0068987.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":8,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"I spent a bit of time today updating my website after some changes in the MyST-NB and Sphinx Design ecosystems.\nAlong the way, I decided to redirect ","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"fQUhbB0g2V"},{"type":"inlineCode","value":"/posts/","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"ycGeLvoKmZ"},{"type":"text","value":" to ","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"LOS8XYfsus"},{"type":"inlineCode","value":"/blog/","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"K3fSdMvZVr"},{"type":"text","value":", since it seems ","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"sB4Xm8msnQ"},{"type":"inlineCode","value":"/blog/","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"KoDdgJbl1R"},{"type":"text","value":" is a much more common folder to use for blog posts.","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"QCTNmYy8cE"}],"key":"BqXaedP987"},{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"This posed a problem, because ","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"N4pFA2wld2"},{"type":"link","url":"https://github.com/wpilibsuite/sphinxext-rediraffe","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"the ","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"Wptf0A5tHE"},{"type":"inlineCode","value":"sphinx-rediraffe","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"S6lTLOeNqH"},{"type":"text","value":" extension","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"eJzl677zRU"}],"urlSource":"https://github.com/wpilibsuite/sphinxext-rediraffe","error":true,"key":"wL62ea9n5E"},{"type":"text","value":" does not allow you to redirect folders with wildcards.\nAKA, you cannot do:","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"G8xStejWV3"}],"key":"ohg2trDCac"},{"type":"code","lang":"python","value":"rediraffe_redirects = {\n    \"posts/**/*.md\": \"blog/**/*.md\",\n}","position":{"start":{"line":14,"column":1},"end":{"line":18,"column":1}},"key":"QDbZs9kg2Y"},{"type":"paragraph","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"I also didn’t want to have to manually specify every single blog post, since that’d be a very long list.","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"vOJsXAjyR0"}],"key":"dZq6h7m6Yr"},{"type":"paragraph","position":{"start":{"line":22,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"text","value":"Fortunately, I figured out a solution because ","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"IaxfBxGXpk"},{"type":"emphasis","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"text","value":"Sphinx’s configuration is also a Python script","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"BzLO0N6pqP"}],"key":"C52ElRniBb"},{"type":"text","value":".\nThis means you can dynamically populate this configuration with ","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"XTbmyAPwbL"},{"type":"inlineCode","value":"pathlib","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"KzDNkxAeLx"},{"type":"text","value":".\nI’ll share the code snippet below in case it’s useful for others:","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"tZslZRAIjF"}],"key":"UMvKZr2hzU"},{"type":"container","kind":"code","children":[{"type":"code","lang":"python","value":"# These are posts I *want* to manually specify\nrediraffe_redirects = {\n    \"rust-governance.md\": \"blog/2018/rust_governance.md\",\n}\n# Update the posts/* section of the rediraffe redirects to find all files\nredirect_folders = {\n    \"posts\": \"blog\",\n}\nfrom pathlib import Path\nfor old, new in redirect_folders.items():\n    for newpath in Path(new).rglob(\"**/*\"):\n        if newpath.suffix in [\".ipynb\", \".md\"]:\n            oldpath = str(newpath).replace(\"blog/\", \"posts/\", 1)\n            rediraffe_redirects[oldpath] = str(newpath)","key":"hMRYJ1le2D"},{"type":"caption","children":[{"type":"paragraph","children":[{"type":"text","value":"conf.py","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"QKVMX8NAZ9"}],"key":"Fd1Lv9KorQ"}],"key":"fHLVtQh8OM"}],"enumerator":"1","key":"HZw3ZKmkq3"}],"key":"vdeNfFYEgz"}],"key":"PxmVXiz36Q"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Custom roles and domains in Sphinx with one line","url":"/blog/2022/sphinx-custom-crossrefs","group":"2022"},"next":{"title":"How to update Sphinx options during the build","url":"/blog/2022/sphinx-update-config","group":"2022"}}},"domain":"http://localhost:3000"}