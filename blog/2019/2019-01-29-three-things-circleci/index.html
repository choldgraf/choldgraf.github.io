
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<meta property="og:title" content="Three things I love about CircleCI" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://chrisholdgraf.com/blog/2019/2019-01-29-three-things-circleci/" />
<meta property="og:site_name" content="Chris Holdgraf" />
<meta property="og:description" content="I recently had to beef up the continuous deployment of Jupyter Book, and used it as an opportunity to learn a bit more about CircleCI’s features. It turns out, they’re pretty cool! Here are a few o..." />
<meta property="og:image" content="https://chrisholdgraf.com/_images/social_previews/summary_blog_2019_2019-01-29-three-things-circleci_11a0b563.png" />
<meta property="og:image:alt" content="I recently had to beef up the continuous deployment of Jupyter Book, and used it as an opportunity to learn a bit more about CircleCI’s features. It turns ou..." />
<meta name="description" content="I recently had to beef up the continuous deployment of Jupyter Book, and used it as an opportunity to learn a bit more about CircleCI’s features. It turns out, they’re pretty cool! Here are a few o..." />

    <title>Three things I love about CircleCI &#8212; Chris Holdgraf</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=961bdc270ee8274e4563" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=961bdc270ee8274e4563" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=961bdc270ee8274e4563" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=961bdc270ee8274e4563" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/sphinx-examples.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=961bdc270ee8274e4563" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=961bdc270ee8274e4563" />

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/design-tabs.js"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=UA-88310237-1"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'UA-88310237-1');
            </script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'blog/2019/2019-01-29-three-things-circleci';</script>
    <link rel="shortcut icon" href="../../../_static/profile-color-circle-small.png"/>
    <link rel="author" title="About these documents" href="../../../about/" />
    <link rel="index" title="Index" href="../../../genindex/" />
    <link rel="search" title="Search" href="../../../search/" />

  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>

<link
  rel="alternate"
  type="application/atom+xml"
  href="../../../blog/atom.xml"
  title="Chris Holdgraf"
/>



  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target="#bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search/"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this site..."
         aria-label="Search this site..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar" id="navbar-main"><div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  <div id="navbar-start">
    
      
  

<a class="navbar-brand logo" href="../../../">
  
  
  
  
  
    <p class="title logo__title">Chris Holdgraf</p>
  
</a>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    <div id="navbar-center" class="me-auto">
      
        <div class="navbar-center-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul id="navbar-main-elements" class="navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../about/">
                        About me
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../projects/">
                        Projects
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../publications/">
                        Published
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../talks/">
                        Talks
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../">
                        Blog
                      </a>
                    </li>
                
  </ul>
</nav></div>
      
    </div>
    <div id="navbar-end">
      
        <div class="navbar-end-item navbar-persistent--container">
          
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="fa-solid fa-magnifying-glass"></i>
</button>
        </div>
      
      
        <div class="navbar-end-item"><button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
</button></div>
      
        <div class="navbar-end-item"><ul id="navbar-icon-links"
    class="navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/choldgraf/" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://twitter.com/choldgraf" title="Twitter" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-twitter"></i></span>
            <label class="sr-only">Twitter</label></a>
        </li>
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://hachyderm.io/@choldgraf" title="Mastodon" class="nav-link" rel="me" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-mastodon"></i></span>
            <label class="sr-only">Mastodon</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://chrisholdgraf.com/blog/atom.xml" title="Blog RSS feed" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-solid fa-rss"></i></span>
            <label class="sr-only">Blog RSS feed</label></a>
        </li>
</ul></div>
      
    </div>
  </div>
  
  
    <div class="navbar-persistent--mobile">
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="fa-solid fa-magnifying-glass"></i>
</button>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        
  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-center-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul id="navbar-main-elements" class="navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../about/">
                        About me
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../projects/">
                        Projects
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../publications/">
                        Published
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../talks/">
                        Talks
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../">
                        Blog
                      </a>
                    </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-end-item"><button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
</button></div>
        
          <div class="navbar-end-item"><ul id="navbar-icon-links"
    class="navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/choldgraf/" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://twitter.com/choldgraf" title="Twitter" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-twitter"></i></span>
            <label class="sr-only">Twitter</label></a>
        </li>
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://hachyderm.io/@choldgraf" title="Mastodon" class="nav-link" rel="me" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-mastodon"></i></span>
            <label class="sr-only">Mastodon</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://chrisholdgraf.com/blog/atom.xml" title="Blog RSS feed" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-solid fa-rss"></i></span>
            <label class="sr-only">Blog RSS feed</label></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-start-items sidebar-primary__section">
        <div class="sidebar-start-items__item">
<div class="ablog-sidebar-item ablog__postcard">


<h2>
  
  
  <i class="fa fa-calendar"></i>
  
  29 January 2019
  
</h2>
<ul>
  




<li id="ablog-sidebar-item category ablog__category">
  <span>
    
    <i class="fa-fw fa fa-folder-open"></i>
    
    </span>
  
  
  <a href="../../category/thoughts/">thoughts</a>
  
  
  
</li>


<li id="ablog-sidebar-item tags ablog__tags">
  <span>
    
    
    <i class="fa-fw fa fa-tags"></i>
    
    
    </span>
  
  
  <a href="../../tag/software-development/">software development</a>
  
  
  
  
  
  <a href="../../tag/dev-ops/">dev ops</a>
  
  
  
  
  
  <a href="../../tag/cicd/">CICD</a>
  
  
  
</li>


</ul>
</div>
</div>
        <div class="sidebar-start-items__item">
<div class="ablog-sidebar-item ablog__recentposts">
<h3>
  <a href="../../">Recent Posts</a>
</h3>
<ul>
  
  
  <li>
    <a href="../../2023/fosdem/">
      06 February - Reflections from FOSDEM23: the beautiful chaos of open source in a conference
    </a>
  </li>
  
  <li>
    <a href="../../2022/install-github-from-pyproject/">
      31 December - Install dependencies from GitHub with pyproject.toml or requirements.txt
    </a>
  </li>
  
  <li>
    <a href="../../2022/jupyterlite-workshop/">
      10 December - Report from the JupyterLite workshop: WebAssembly is pretty cool
    </a>
  </li>
  
  <li>
    <a href="../../2022/matplotlib-remote-font/">
      06 December - Load and plot a remote font with Matplotlib
    </a>
  </li>
  
  <li>
    <a href="../../2022/sphinx-update-config/">
      05 December - Update Sphinx configuration during the build by modifying app.config
    </a>
  </li>
  
</ul>
</div>
</div>
        <div class="sidebar-start-items__item">
<div class="ablog-sidebar-item ablog__archive">
<h3>
  <a href="../../archive/">Archives</a>
</h3>
<ul>
  
  
  <li>
    <a href="../../2023/">2023 (1)</a>
  </li>
  
  
  
  <li>
    <a href="../../2022/">2022 (11)</a>
  </li>
  
  
  
  <li>
    <a href="../../2021/">2021 (1)</a>
  </li>
  
  
  
  <li>
    <a href="../../2020/">2020 (4)</a>
  </li>
  
  
  
  <li>
    <a href="../">2019 (7)</a>
  </li>
  
  
  
  <li>
    <a href="../../2018/">2018 (11)</a>
  </li>
  
  
  
  <li>
    <a href="../../2017/">2017 (3)</a>
  </li>
  
  
  
  <li>
    <a href="../../2016/">2016 (6)</a>
  </li>
  
  
  
  <li>
    <a href="../../2015/">2015 (4)</a>
  </li>
  
  
</ul>
</div>
</div>
    </div>
  
  
  <div class="sidebar-end-items sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>

      </div>
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article"></div>
              
              

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
<section id="three-things-i-love-about-circleci">
<h1>Three things I love about CircleCI<a class="headerlink" href="#three-things-i-love-about-circleci" title="Permalink to this heading">#</a></h1>
<p>I recently had to beef up the continuous deployment of Jupyter Book, and used
it as an opportunity to learn a bit more about CircleCI’s features. It turns out,
they’re pretty cool! Here are a few of the things that I learned this time around.</p>
<p>For those who aren’t familiar with CircleCI, it is a service that runs Continuous
Integration and Continuous Deployment (CI/CD) workflows for projects. This basically
means that they manage many kinds of infrastructure that can launch jobs that run
test suites, deploy applications, and test on many different environments.</p>
<p>Here are some cool things that I now have a much better appreciation for:</p>
<section id="re-run-a-job-with-ssh-access">
<h2>Re-run a job with SSH access<a class="headerlink" href="#re-run-a-job-with-ssh-access" title="Permalink to this heading">#</a></h2>
<p>Often when tests don’t pass or a build otherwise fails, it’s really helpful to be
able to get into the machine itself and just start poking around. It turns out that
CircleCI makes this really easy! If a build has failed, then you can use the drop-down
menu next to the “Restart Job” button to select “Restart Job with SSH”. The next time
the job fails (which it probably will, since you’ve just restarted a job that already
failed once), CircleCI will print the IP address and SSH command to connect to that
machine remotely.</p>
</section>
<section id="persisting-files-between-jobs-with-workspaces">
<h2>Persisting files between jobs with Workspaces<a class="headerlink" href="#persisting-files-between-jobs-with-workspaces" title="Permalink to this heading">#</a></h2>
<p>Everything CircleCI does is based around containers - each job has a Docker image
environment specified (and CircleCI curates a large list of containers for testing).
One challenge this introduces is that it can be more complex to use jobs that have
<em>multiple</em> languages or tools installed. You can always manually configure this, but
I’ve found that another easy solution is to split your task across multiple jobs,
and persist some of the files between them with CircleCI workspaces.</p>
<p>To set up a CircleCI workspace, you first need two jobs, then</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">jobs</span><span class="p">:</span>
<span class="w">  </span><span class="nt">build_files</span><span class="p">:</span>
<span class="w">    </span><span class="nt">docker</span><span class="p">:</span>
<span class="w">      </span><span class="c1"># We use a Python image to test our files and run the test suite</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">circleci/python:3.6-stretch</span>
<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">      </span><span class="c1"># Some steps to build files we need in another job</span>
<span class="w">      </span><span class="c1"># Assume it places the built files into a folder called `_build/`</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">build_stuff_with_python</span>

<span class="w">      </span><span class="c1"># Persist the specified paths (see https://circleci.com/docs/2.0/workflows/#using-workspaces-to-share-data-among-jobs)</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">persist_to_workspace</span><span class="p">:</span>
<span class="w">          </span><span class="c1"># The root of the workspace, here just the CWD</span>
<span class="w">          </span><span class="nt">root</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.</span>
<span class="w">          </span><span class="c1"># The sub-paths of the workspace to persist</span>
<span class="w">          </span><span class="nt">paths</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_build/</span>

<span class="w">  </span><span class="nt">deploy_files</span><span class="p">:</span>
<span class="w">    </span><span class="nt">docker</span><span class="p">:</span>
<span class="w">      </span><span class="c1"># We&#39;ll use a Ruby image to deploy our files</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">circleci/ruby:2.6</span>
<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">      </span><span class="c1"># Connect the files from the last job to this job</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">attach_workspace</span><span class="p">:</span>
<span class="w">          </span><span class="c1"># Must be absolute path or relative path from working_directory</span>
<span class="w">          </span><span class="nt">at</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tmp/workspace</span>

<span class="w">      </span><span class="c1"># Our final deployment steps</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deploy_files_with_ruby</span>
</pre></div>
</div>
<p>Finally, we’ll set up a CircleCI workflow that runs the deployment job only after the
build job as finished, since the deploy job depends on files that are created by the
build job.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">workflows</span><span class="p">:</span>
<span class="w">  </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="w">  </span><span class="nt">default</span><span class="p">:</span>
<span class="w">    </span><span class="nt">jobs</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">build_files</span>
<span class="w">      </span><span class="c1">#</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">deploy_files</span><span class="p">:</span>
<span class="w">          </span><span class="nt">requires</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">build_files</span>
</pre></div>
</div>
<p>In this way, we’ve split our task (build a bunch of files, then deploy them online)
into two different jobs. One that builds files with a Python container, and another that
deploys them with a Ruby container.</p>
</section>
<section id="re-use-code-snippets-with-commands">
<h2>Re-use code snippets with Commands<a class="headerlink" href="#re-use-code-snippets-with-commands" title="Permalink to this heading">#</a></h2>
<p>Finally, many times you’d like to re-use the same set of snippets across multiple
points of your CircleCI jobs. In 2.1, CircleCI added a new feature called Commands
that does this fairly simply. Commands are kind of like functions in that they
wrap up a collection of steps that can be re-used and parameterized. This means you
can define a “template” of a collection of steps, then fill-in missing fields in that
template in order to modify its behavior.</p>
<p>For example, here’s a Command template to build a site with Jekyll:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">commands</span><span class="p">:</span>
<span class="w">  </span><span class="nt">build_site</span><span class="p">:</span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Build</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">site</span><span class="nv"> </span><span class="s">with</span><span class="nv"> </span><span class="s">Jekyll&quot;</span>
<span class="w">    </span><span class="nt">parameters</span><span class="p">:</span>
<span class="w">      </span><span class="c1"># We&#39;ll define one parameter that lets us pass build arguments to Jekyll build</span>
<span class="w">      </span><span class="nt">build_args</span><span class="p">:</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
<span class="w">        </span><span class="nt">default</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">run</span><span class="p">:</span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Build the website</span>
<span class="w">          </span><span class="c1"># Note the &lt;&lt; parameters.param &gt;&gt; syntax that lets you define your own inputs</span>
<span class="w">          </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bundle exec jekyll build &lt;&lt; parameters.build_args &gt;&gt;</span>
</pre></div>
</div>
<p>Now, we can re-use this command throughout our build steps. Here are two jobs that use
this command in different ways:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">jobs</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># Build the site to store artifacts</span>
<span class="w">  </span><span class="nt">build_with_params</span><span class="p">:</span>
<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">      </span><span class="c1"># Build the site&#39;s HTML w/ the base_url for CircleCI artifacts</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">build_site</span><span class="p">:</span>
<span class="w">          </span><span class="nt">build_args</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">--baseurl /0/html/</span>
<span class="w">  </span><span class="c1"># Build the site to store artifacts</span>
<span class="w">  </span><span class="nt">build_without_params</span><span class="p">:</span>
<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">      </span><span class="c1"># Build the site&#39;s HTML w/ defaults for Jekyll</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">build_site</span><span class="p">:</span>
<span class="w">          </span><span class="nt">build_args</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
</pre></div>
</div>
<p>Each of these jobs uses the command specified above in <code class="docutils literal notranslate"><span class="pre">build_site</span></code>, but
they use the <code class="docutils literal notranslate"><span class="pre">build_args</span></code> parameter to modify its behavior each time.</p>
</section>
</section>

<div class="section ablog__blog_comments">
  
  


<div class="section ablog__prev-next">
  <span class="ablog__prev">
    
    
    <a href="../../2018/circlci-github/">
      
      <i class="fa fa-arrow-circle-left"></i>
      
      <span>Automatically mirror a github repository with CircleCI</span>
    </a>
    
  </span>
  <span class="ablog__spacer">&nbsp;</span>
  <span class="ablog__next">
    
    
    <a href="../2019-03-16-jupyter-dev/">
      <span>Thoughts from the Jupyter team meeting 2019</span>
      
      <i class="fa fa-arrow-circle-right" ></i>
      
    </a>
    
  </span>
</div>

  
  
</div>

                </article>
              
<!-- Add a comment box underneath the page's content -->
<script src="https://giscus.app/client.js"
        data-repo="choldgraf/choldgraf.github.io"
        data-repo-id="MDEwOlJlcG9zaXRvcnk1MTIzNzA1NA=="
        data-category="Blog comments"
        data-category-id="DIC_kwDOAw3Qvs4CAV4E"
        data-mapping="pathname"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-theme="light"
        data-lang="en"
        crossorigin="anonymous"
        async>
</script>

              
              
                <footer class="bd-footer-article">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc">
  <div class="toc-item">
  <div class="tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav id="bd-toc-nav" class="page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#re-run-a-job-with-ssh-access">Re-run a job with SSH access</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#persisting-files-between-jobs-with-workspaces">Persisting files between jobs with Workspaces</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#re-use-code-snippets-with-commands">Re-use code snippets with Commands</a></li>
</ul>
  </nav></div>

  <div class="toc-item">
  <div class="tocsection sourcelink">
    <a href="../../../_sources/blog/2019/2019-01-29-three-things-circleci.md.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>
</div>
              
            
          </div>
          <footer class="bd-footer-content">
            <div class="bd-footer-content__inner"></div>
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=961bdc270ee8274e4563"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=961bdc270ee8274e4563"></script>

  <footer class="bd-footer"><div class="bd-footer__inner container">
  
    <div class="footer-item">
  <p class="copyright">
    
      ©; Copyright 2022, Chris Holdgraf.
      <br/>
    
  </p>
</div>
  
    <div class="footer-item"><p class="theme-version">
  Built with the
  <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a>
  0.13.0rc1.
</p></div>
  
    <div class="footer-item">
  <p class="sphinx-version">
    Created using <a href="https://sphinx-doc.org/">Sphinx</a> 5.3.0.
    <br/>
  </p>
</div>
  
</div>
  </footer>
  </body>
</html>