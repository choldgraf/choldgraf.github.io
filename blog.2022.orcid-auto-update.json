{"version":2,"kind":"Article","sha256":"ddf85d43759abab22c8c9bc6165ca09ccbdf3f81d72079c21f6a504252b76c55","slug":"blog.2022.orcid-auto-update","location":"/blog/2022/orcid-auto-update.md","dependencies":[],"frontmatter":{"title":"Automatically updating my publications page with ORCID and doi.org","tags":["scholarship","doi","orcid"],"date":"2022-11-19","content_includes_title":false,"authors":[{"id":"chris","nameParsed":{"literal":"Chris Holdgraf","given":"Chris","family":"Holdgraf"},"name":"Chris Holdgraf","orcid":"0000-0002-2391-0678","affiliations":["affiliations-myst-generated-uid-0","affiliations-myst-generated-uid-1"],"url":"https://chrisholdgraf.com","github":"choldgraf","twitter":"choldgraf"}],"github":"https://github.com/choldgraf/choldgraf.github.io","affiliations":[{"name":"2i2c","url":"https://2i2c.org","id":"affiliations-myst-generated-uid-0"},{"name":"Project Jupyter","url":"https://jupyter.org","id":"affiliations-myst-generated-uid-1"}],"abbreviations":{"LF":"The Linux Foundation","JF":"The Jupyter Foundation","JEC":"Jupyter Executive Council","JFB":"The Jupyter Foundation Board","SSC":"Software Steering Council","OSPO":"Open Source Program Office"},"numbering":{"title":{"offset":2}},"source_url":"https://github.com/choldgraf/choldgraf.github.io/blob/main/blog/2022/orcid-auto-update.md","edit_url":"https://github.com/choldgraf/choldgraf.github.io/edit/main/blog/2022/orcid-auto-update.md","exports":[{"format":"md","filename":"orcid-auto-update.md","url":"/build/orcid-auto-update-42db1f7e7bc1c5b260c828625c377031.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":12,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"For a while Iâ€™ve had a hand-crafted ","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"czxCSJsejW"},{"type":"inlineCode","value":".bibtex","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"Isx1kP6Vr3"},{"type":"text","value":" file stored locally for ","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"XhY3FNKb6B"},{"type":"link","url":"/publications","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"my ","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"mKLYb3pH4R"},{"type":"inlineCode","value":"publications/","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"oTn3ndpdFX"},{"type":"text","value":" page","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"JQlpEogPQH"}],"urlSource":"../../publications.md","dataUrl":"/publications.json","internal":true,"protocol":"file","key":"pCKLdA356k"},{"type":"text","value":".\nHowever, manually updating local text file is a pain to remember, especially since there are many services out there that automatically track new publications.","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"IrfnXpkuHW"}],"key":"QkL56Cw9DB"},{"type":"admonition","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Update!","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"SoBUbm0K9G"}],"key":"lOIc0LZsaE"},{"type":"paragraph","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"A ","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"Zq3pH532Rv"},{"type":"link","url":"https://twitter.com/temorrell/status/1594749942316208128","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"helpful suggestion on Twitter","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"nPJZyOv6Jn"}],"urlSource":"https://twitter.com/temorrell/status/1594749942316208128","key":"cbxz6BeBXO"},{"type":"text","value":" allowed me to include the full citation information, including lists of authors, using the ","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"NtLkKSU9u8"},{"type":"link","url":"http://doi.org","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"doi.org","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"kFZQ7Ny4GS"}],"urlSource":"http://doi.org","key":"H9uqgNa0A8"},{"type":"text","value":" API!","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"hjKN2jiQdw"}],"key":"f3bfBlMYWz"}],"key":"rsiBQA18GP"},{"type":"paragraph","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"Hereâ€™s the workflow Iâ€™d prefer:","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"oE00UHUu7j"}],"key":"Om3ofrjUy8"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":21,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Treat one online service provider as a ","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"vFaZ2u0eeM"},{"type":"strong","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"Single Source of Truth","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"Fpz6Bc4bEI"}],"key":"TPHsp7oWCH"},{"type":"text","value":" for my publications list.","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"nPkxWqv8m4"}],"key":"SN89M8NfhU"}],"key":"K4tp3fY9E2"},{"type":"listItem","spread":true,"position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Use an API to programmatically ask this provider for the ","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"pnfnSTozq1"},{"type":"emphasis","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"text","value":"latest","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"ANYPE6amnn"}],"key":"yAKwkfVQmE"},{"type":"text","value":" data about my publications.","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"PwJ9NzBDA6"}],"key":"gS4ozToQ6d"}],"key":"GKU0LOoEHg"},{"type":"listItem","spread":true,"position":{"start":{"line":23,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Reshape that data into a form that I can insert into my website.","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"a1SkHg5XEc"}],"key":"zPs2U23JGG"}],"key":"jCpWfYIJbu"}],"key":"b8wmR4Jt5w"},{"type":"paragraph","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"text","value":"Hereâ€™s how I accomplished this:","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"oGOtcoDPOo"}],"key":"AU1EMTyZLO"},{"type":"heading","depth":2,"position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"text","value":"Use ORCID to grab a list of DOIs for my publications","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"QpMfFZHvUo"}],"identifier":"use-orcid-to-grab-a-list-of-dois-for-my-publications","label":"Use ORCID to grab a list of DOIs for my publications","html_id":"use-orcid-to-grab-a-list-of-dois-for-my-publications","implicit":true,"key":"YXmjTdyQxY"},{"type":"paragraph","position":{"start":{"line":29,"column":1},"end":{"line":31,"column":1}},"children":[{"type":"link","url":"https://info.orcid.org/what-is-orcid/","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"children":[{"type":"text","value":"ORCID is a service for identifying scholars and their contributions","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"DpOjiizPEV"}],"urlSource":"https://info.orcid.org/what-is-orcid/","key":"IN2GnFBIoe"},{"type":"text","value":".\nIt links various kinds of publications and activities to a unique account for each person.\nIt doesnâ€™t cover ","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"eF4jZplpsr"},{"type":"emphasis","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"children":[{"type":"text","value":"all","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"hS7GxLnNa2"}],"key":"Bo6pEq17v8"},{"type":"text","value":" kinds of outputs (like talks, posters, etc), but it seems to cover the most important ones.","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"CUHjMiFyJj"}],"key":"tQsodRTKyY"},{"type":"paragraph","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"children":[{"type":"text","value":"ðŸ‘‰ Here is my ORCID ID and page: ","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"key":"ArLwaTbCdm"},{"type":"link","url":"https://orcid.org/0000-0002-2391-0678","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"children":[{"type":"inlineCode","value":"https://orcid.org/0000-0002-2391-0678","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"key":"TaEieiWwjr"}],"urlSource":"https://orcid.org/0000-0002-2391-0678","key":"D7ql0NYcgv"},{"type":"text","value":".","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"key":"qfnCirHUiL"}],"key":"r1OKCDs9vL"},{"type":"paragraph","position":{"start":{"line":35,"column":1},"end":{"line":36,"column":1}},"children":[{"type":"text","value":"ORCID has ","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"SfERe68kzN"},{"type":"link","url":"https://info.orcid.org/documentation/features/public-api/","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"children":[{"type":"text","value":"a public-facing API","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"xpyRkSbIpb"}],"urlSource":"https://info.orcid.org/documentation/features/public-api/","key":"Rk8Be71FhJ"},{"type":"text","value":" that allows you to automatically query information about an ORCID ID.\nFollowing ","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"xeLVm8J3w3"},{"type":"link","url":"https://github.com/Project-TAPIR/pidgraph-notebooks/blob/main/person-works/orcid_get_works_by_person.ipynb","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"children":[{"type":"text","value":"an example notebook shared from the TAPIR project","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"EaeAf0c5eN"}],"urlSource":"https://github.com/Project-TAPIR/pidgraph-notebooks/blob/main/person-works/orcid_get_works_by_person.ipynb","data":{"kind":"file","org":"Project-TAPIR","repo":"pidgraph-notebooks","reference":"main","file":"person-works/orcid_get_works_by_person.ipynb","raw":"https://raw.githubusercontent.com/Project-TAPIR/pidgraph-notebooks/main/person-works/orcid_get_works_by_person.ipynb"},"internal":false,"protocol":"github","key":"y7YI22x762"},{"type":"text","value":".","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"SXmX7fTOK0"}],"key":"RGYTe9sO9T"},{"type":"heading","depth":2,"position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"children":[{"type":"text","value":"Use the ","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"vGpu5MUKwb"},{"type":"link","url":"http://doi.org","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"children":[{"type":"text","value":"doi.org","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"Iz6TLcavi1"}],"urlSource":"http://doi.org","key":"UlQbXkPNJN"},{"type":"text","value":" API to grab citation information","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"ljmTFoFVhp"}],"identifier":"use-the-doi-org-api-to-grab-citation-information","label":"Use the doi.org API to grab citation information","html_id":"use-the-doi-org-api-to-grab-citation-information","implicit":true,"key":"jCSewEKBI2"},{"type":"paragraph","position":{"start":{"line":40,"column":1},"end":{"line":41,"column":1}},"children":[{"type":"text","value":"While the ORCID API has a lot of useful information in it, there were some important pieces missing, like ","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"key":"C8CoB1vu4F"},{"type":"strong","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"children":[{"type":"text","value":"co-author information","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"key":"CTTQOF6jRD"}],"key":"jukaZ1qGky"},{"type":"text","value":".\nFortunately, I learned ","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"key":"jVAdk7PGMY"},{"type":"link","url":"https://twitter.com/temorrell/status/1594749942316208128","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"children":[{"type":"text","value":"from a suggestion on Twitter","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"key":"jJs24lPywu"}],"urlSource":"https://twitter.com/temorrell/status/1594749942316208128","key":"DRmpjOrp99"},{"type":"text","value":" that ","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"key":"lUxDg0jEL5"},{"type":"link","url":"https://doi.org","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"children":[{"type":"text","value":"doi.org","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"key":"iUBxwNIJwe"}],"urlSource":"https://doi.org","key":"QZw6WiADn9"},{"type":"text","value":" is accessible via an API call!","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"key":"fcT9DGH6Dn"}],"key":"nK8cCJ9UGU"},{"type":"paragraph","position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"children":[{"type":"text","value":"You can ask ","position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"key":"xZJEjot8Wk"},{"type":"inlineCode","value":"doi.org","position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"key":"wInKs11BoC"},{"type":"text","value":" for the reference, bibtex file, or a JSON structure of reference data by adding a header to a ","position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"key":"IqZzp8U3DA"},{"type":"link","url":"http://doi.org","position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"children":[{"type":"text","value":"doi.org","position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"key":"MzqihRRfhS"}],"urlSource":"http://doi.org","key":"HnZC9covgt"},{"type":"text","value":" URL, like so:","position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"key":"RlEiH5Gd0R"}],"key":"PWlagqeJ5h"},{"type":"code","lang":"","value":"curl -L -H \"Accept:text/x-bibliography; style=apa\" -H \"User-Agent: mailto:youremail@email.com\" https://dx.doi.org/10.1371/journal.pcbi.1009651","position":{"start":{"line":45,"column":1},"end":{"line":47,"column":1}},"key":"Op2J1b4Fyr"},{"type":"paragraph","position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"children":[{"type":"text","value":"This returns a fully-resolved reference like so:","position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"key":"c8hT6BTiRK"}],"key":"kwuBaJnor9"},{"type":"code","lang":"","value":"DuPre, E., Holdgraf, C., Karakuzu, A., Tetrel, L., Bellec, P., Stikov, N., & Poline, J.-B. (2022). Beyond advertising: New infrastructures for publishing integrated research objects. PLOS Computational Biology, 18(1), e1009651. https://doi.org/10.1371/journal.pcbi.1009651","position":{"start":{"line":51,"column":1},"end":{"line":53,"column":1}},"key":"p265Bv88s1"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Note","key":"p1LckfBBBK"}],"key":"yvOYjR54vs"},{"type":"paragraph","position":{"start":{"line":56,"column":1},"end":{"line":56,"column":1}},"children":[{"type":"text","value":"The ","position":{"start":{"line":56,"column":1},"end":{"line":56,"column":1}},"key":"eHcg0nLAPD"},{"type":"inlineCode","value":"-H \"User-Agent: mailto:youremail@email.com\"","position":{"start":{"line":56,"column":1},"end":{"line":56,"column":1}},"key":"s7Sf7te3An"},{"type":"text","value":" is a way to identify yourself to the ","position":{"start":{"line":56,"column":1},"end":{"line":56,"column":1}},"key":"fOGP2w4PrH"},{"type":"inlineCode","value":"doi.org","position":{"start":{"line":56,"column":1},"end":{"line":56,"column":1}},"key":"GoXMnJ1raM"},{"type":"text","value":" API, which reduces the likelihood that you will have your access revoked.","position":{"start":{"line":56,"column":1},"end":{"line":56,"column":1}},"key":"iJDokT5E1V"}],"key":"ZaTmj3cYUv"}],"key":"Rr5t4NKNLh"},{"type":"paragraph","position":{"start":{"line":59,"column":1},"end":{"line":59,"column":1}},"children":[{"type":"text","value":"In Python, the same call looks like this:","position":{"start":{"line":59,"column":1},"end":{"line":59,"column":1}},"key":"NLl4s5VEKw"}],"key":"pTQeqAuvgo"},{"type":"code","lang":"python","value":"from requests import get\ndoi = \"10.1371/journal.pcbi.1009651\"\nurl = f\"https://dx.doi.org/{doi}\"\nheader = {\"accept\": \"text/x-bibliography; style=apa\", \"User-Agent\": \"mailto:youremail@email.com\"}\nr = requests.get(url, headers=header)\nprint(r.content)","position":{"start":{"line":61,"column":1},"end":{"line":68,"column":1}},"key":"hGTnQvYhu4"},{"type":"paragraph","position":{"start":{"line":70,"column":1},"end":{"line":70,"column":1}},"children":[{"type":"text","value":"You can also use other kinds of header configuration, like:","position":{"start":{"line":70,"column":1},"end":{"line":70,"column":1}},"key":"jhGRm8C10Q"}],"key":"iTcnSFAVFu"},{"type":"code","lang":"python","value":"# A citeproc-styled JSON structure\nheader = {'accept': \"citeproc+json\"}\n# A bibtex entry\nheader = {'accept': \"bibtex\"}","position":{"start":{"line":72,"column":1},"end":{"line":77,"column":1}},"key":"gZQX57zPTe"},{"type":"paragraph","position":{"start":{"line":79,"column":1},"end":{"line":80,"column":1}},"children":[{"type":"text","value":"The citeproc JSON structure has a ton of information in it, including information about all of the co-authors (and an extra bonus - a link to their ORCID pages!).\nThis is all the information I needed for my website.","position":{"start":{"line":79,"column":1},"end":{"line":79,"column":1}},"key":"mycsyjNbcK"}],"key":"jGLNdFyETt"},{"type":"heading","depth":2,"position":{"start":{"line":82,"column":1},"end":{"line":82,"column":1}},"children":[{"type":"text","value":"A script to do this all at once","position":{"start":{"line":82,"column":1},"end":{"line":82,"column":1}},"key":"M20tR8aVw2"}],"identifier":"a-script-to-do-this-all-at-once","label":"A script to do this all at once","html_id":"a-script-to-do-this-all-at-once","implicit":true,"key":"HCUdtzkjwX"},{"type":"paragraph","position":{"start":{"line":84,"column":1},"end":{"line":85,"column":1}},"children":[{"type":"text","value":"I wrote a little script that runs each time my Sphinx site is built.\nIt generates a markdown snippet that is then inserted into my ","position":{"start":{"line":84,"column":1},"end":{"line":84,"column":1}},"key":"dYcVaZfE2I"},{"type":"inlineCode","value":"publications.md","position":{"start":{"line":84,"column":1},"end":{"line":84,"column":1}},"key":"A3nHLUUR9x"},{"type":"text","value":" page.","position":{"start":{"line":84,"column":1},"end":{"line":84,"column":1}},"key":"n4TXWqdxXM"}],"key":"Q0ppPDm5C0"},{"type":"details","children":[{"type":"summary","children":[{"type":"text","value":"Python snippet to download ORCID data","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"key":"hDax32Pgkm"}],"key":"kIlxFf2LWa"},{"type":"paragraph","position":{"start":{"line":88,"column":1},"end":{"line":88,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":88,"column":1},"end":{"line":88,"column":1}},"children":[{"type":"text","value":"Note that the below is ","position":{"start":{"line":88,"column":1},"end":{"line":88,"column":1}},"key":"JfDvKWSe2j"},{"type":"link","url":"https://jupytext.readthedocs.io/en/latest/install.html","position":{"start":{"line":88,"column":1},"end":{"line":88,"column":1}},"children":[{"type":"text","value":"a ","position":{"start":{"line":88,"column":1},"end":{"line":88,"column":1}},"key":"gHMAcMibq3"},{"type":"inlineCode","value":"jupytext","position":{"start":{"line":88,"column":1},"end":{"line":88,"column":1}},"key":"x8XjtLUg9m"},{"type":"text","value":" document","position":{"start":{"line":88,"column":1},"end":{"line":88,"column":1}},"key":"qXtJzn907J"}],"urlSource":"https://jupytext.readthedocs.io/en/latest/install.html","key":"Zb05sv0Pjx"},{"type":"text","value":" which is why thereâ€™s extra metadata at the top","position":{"start":{"line":88,"column":1},"end":{"line":88,"column":1}},"key":"ktpFfD8tom"}],"key":"yExy9CLqee"},{"type":"text","value":".","position":{"start":{"line":88,"column":1},"end":{"line":88,"column":1}},"key":"frNsOkyoY7"}],"key":"GEi6JjZmu3"},{"type":"include","file":"../../scripts/orcid-publications.py","literal":true,"children":[{"type":"code","value":"# ---\n# jupyter:\n#   jupytext:\n#     formats: py:light\n#     text_representation:\n#       extension: .py\n#       format_name: light\n#       format_version: '1.5'\n#       jupytext_version: 1.14.1\n#   kernelspec:\n#     display_name: Python 3 (ipykernel)\n#     language: python\n#     name: python3\n# ---\n\n# +\nimport pandas as pd\nimport requests\nfrom IPython.display import Markdown, JSON\nfrom pathlib import Path\nfrom rich import progress\n\n# My ORCID\norcid_id = \"0000-0002-2391-0678\"\nORCID_RECORD_API = \"https://pub.orcid.org/v3.0/\"\n\n# Download all of my ORCID records\nprint(\"Retrieving ORCID entries from API...\")\nresponse = requests.get(\n    url=requests.utils.requote_uri(ORCID_RECORD_API + orcid_id),\n    headers={\"Accept\": \"application/json\"},\n)\nresponse.raise_for_status()\norcid_record = response.json()\n\n# +\n# Just to visualize in a notebook if need be\n# JSON(orcid_record)\n\n# +\n\n###\n# Resolve my DOIs from ORCID as references\n# Shamelessly copied from:\n# https://gist.github.com/brews/8d3b3ede15d120a86a6bd6fc43859c5e\nimport requests\nimport json\n\n\ndef fetchmeta(doi, fmt=\"reference\", **kwargs):\n    \"\"\"Fetch metadata for a given DOI.\n\n    Parameters\n    ----------\n    doi : str\n    fmt : str, optional\n        Desired metadata format. Can be 'dict' or 'bibtex'.\n        Default is 'dict'.\n    **kwargs :\n        Additional keyword arguments are passed to `json.loads()` if `fmt`\n        is 'dict' and you're a big JSON nerd.\n\n    Returns\n    -------\n    out : str or dict or None\n        `None` is returned if the server gives unhappy response. Usually\n        this means the DOI is bad.\n\n    Examples\n    --------\n    >>> fetchmeta('10.1016/j.dendro.2018.02.005')\n    >>> fetchmeta('10.1016/j.dendro.2018.02.005', 'bibtex')\n\n    References\n    ----------\n    https://www.doi.org/hb.html\n    \"\"\"\n    # Parse args and setup the server response we want.\n    accept_type = \"application/\"\n    if fmt == \"dict\":\n        accept_type += \"citeproc+json\"\n    elif fmt == \"bibtex\":\n        accept_type += \"x-bibtex\"\n    elif fmt == \"reference\":\n        accept_type = \"text/x-bibliography; style=apa\"\n    else:\n        raise ValueError(f\"Unrecognized `fmt`: {fmt}\")\n\n    # Request data from server.\n    url = \"https://dx.doi.org/\" + str(doi)\n    header = {\"accept\": accept_type}\n    r = requests.get(url, headers=header)\n\n    # Format metadata if server response is good.\n    out = None\n    if r.status_code == 200:\n        if fmt == \"dict\":\n            out = json.loads(r.text, **kwargs)\n        else:\n            out = r.text\n    return out\n\n\n# -\n\n# Extract metadata for each entry\ndf = []\nfor iwork in progress.track(\n    orcid_record[\"activities-summary\"][\"works\"][\"group\"], \"Fetching reference data...\"\n):\n    isummary = iwork[\"work-summary\"][0]\n\n    # Extract the DOI\n    for ii in isummary[\"external-ids\"][\"external-id\"]:\n        if ii[\"external-id-type\"] == \"doi\":\n            year = isummary[\"publication-date\"][\"year\"][\"value\"]\n            doi = ii[\"external-id-value\"]\n            break\n    df.append({\"year\": year, \"doi\": doi})\ndf = pd.DataFrame(df)\n\n# Convert into a markdown string\nmd = [\"|Year|Publications|\", \"|===|===|\"]\nfor year, items in df.groupby(\"year\", sort=False):\n    this_pubs = []\n    for _, item in items.iterrows():\n        this_pubs.append(f'{{cite}}`{item[\"doi\"]}`')\n    md.append(f\"|{year}|{', '.join(this_pubs)}|\")\nmds = \"\\n\".join(md)\n\n# +\n# Uncomment to preview in a notebook\n# Markdown(mds)\n# -\n\n# This will only work if this is run as a script\npath_out = Path(__file__).parent.parent / \"_static/publications.txt\"\npath_out.write_text(mds)\nprint(f\"Finished updating ORCID entries at: {path_out}\")\n","lang":"python","filename":"orcid-publications.py","key":"d94USIuFFf"}],"key":"Xxnj1OBsgr"}],"key":"gCTt8GTjVt"}],"key":"LRiSgWaHTM"}],"key":"mdRPViJl1P"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Load and plot a remote font with Matplotlib","url":"/blog/2022/matplotlib-remote-font","group":"2022"},"next":{"title":"Fix phantom GitHub workflows in your ci-cd with protected branch rules","url":"/blog/2022/phantom-workflows-pull-requests","group":"2022"}}},"domain":"http://localhost:3000"}