{"version":1,"kind":"Notebook","sha256":"6ae760ab7221e1ca81f3e68eb4adba9bb5c0ee6f5c5f7f84057782e4285fcd1e","slug":"blog.2015.2015-10-29-nih-grant-analysis","location":"/blog/2015/2015-10-29-nih_grant_analysis.ipynb","dependencies":[],"frontmatter":{"title":"NIH grant analysis","tags":["python","statistics","visualization","grants"],"date":"2015-10-29","kernelspec":{"name":"python3","display_name":"Python 2","language":"python"},"authors":[{"id":"chris","nameParsed":{"literal":"Chris Holdgraf","given":"Chris","family":"Holdgraf"},"name":"Chris Holdgraf","orcid":"0000-0002-2391-0678","affiliations":["affiliations-myst-generated-uid-0","affiliations-myst-generated-uid-1"],"twitter":"choldgraf","github":"choldgraf","url":"https://chrisholdgraf.com"}],"github":"https://github.com/choldgraf/choldgraf.github.io","affiliations":[{"name":"2i2c","url":"https://2i2c.org","id":"affiliations-myst-generated-uid-0"},{"name":"Project Jupyter","url":"https://jupyter.org","id":"affiliations-myst-generated-uid-1"}],"abbreviations":{"LF":"The Linux Foundation","JF":"The Jupyter Foundation","JEC":"Jupyter Executive Council","JFB":"The Jupyter Foundation Board","SSC":"Software Steering Council","OSPO":"Open Source Program Office"},"numbering":{"title":{"offset":2}},"edit_url":"https://github.com/choldgraf/choldgraf.github.io/blob/main/blog/2015/2015-10-29-nih_grant_analysis.ipynb","exports":[{"format":"ipynb","filename":"2015-10-29-nih_grant_analysis.ipynb","url":"/build/2015-10-29-nih_grant-4ec5a4424e34639fc67601fd8f8fc780.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"text","value":"NIH Fellowship Success Rates","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"KQ26cHvXNj"}],"identifier":"nih-fellowship-success-rates","label":"NIH Fellowship Success Rates","html_id":"nih-fellowship-success-rates","implicit":true,"key":"KR3CeYmm8N"},{"type":"paragraph","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"text","value":"As I’m entering the final years of graduate school, I’ve been applying for a few typical “pre-doc” fellowships. One of these is the NRSA, which is notorious for requiring you to wade through forests of beaurocratic documents (seriously, their “guidelines” for writing an NRSA are over 100 pages!). Doing so ends up taking a LOT of time.","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"Uo7P3nivKL"}],"key":"PWuCNvKubX"},{"type":"paragraph","position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"children":[{"type":"text","value":"This got me wondering what kind of success rates these grants have in the first place. For those who haven’t gone through the process before, it’s a bit opaque:","position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"key":"ieD1YBg5RE"}],"key":"kxAvmig1jd"},{"type":"heading","depth":3,"position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"children":[{"type":"text","value":"How the NRSA works","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"key":"BD7LyMarVj"}],"identifier":"how-the-nrsa-works","label":"How the NRSA works","html_id":"how-the-nrsa-works","implicit":true,"key":"Hq0MHXIghX"},{"type":"paragraph","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"children":[{"type":"text","value":"Basically, each NRSA grant is reviewed by a panel of people. They individually review your proposal (which is upwards of 20 pages), and assign it a score in one of several categories. The group then meets, and they give your proposal an “impact score”. This score is then compared with the distribution of scores for all the other proposals in your category, and then a cutoff is made based on the percentiles that they will fund.","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"key":"DecC2GIFqd"}],"key":"wpRlGRBrNH"},{"type":"paragraph","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"children":[{"type":"text","value":"Each year, they change the cutoff, and thus the number of NRSAs, that will be funded. Importantly, this also differs significantly by the NIH branch that oversees your application. Some have much higher success rates than others. For those who are curious, I’m putting a list of the NIH acronyms and their respective centers at the end.","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"oih5RfHGuK"}],"key":"GEvLEdtDHw"},{"type":"heading","depth":3,"position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"children":[{"type":"text","value":"Some data!","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"key":"Aj4733VSKG"}],"identifier":"some-data","label":"Some data!","html_id":"some-data","implicit":true,"key":"YfKs6l1xGA"},{"type":"paragraph","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"children":[{"type":"text","value":"I did a bit of digging and found a dataset for NRSA success rates over the last few years. It’s broken down by grant type, as well as by NIH branch. The results are interesting so I thought I’d put them out there.","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"KDdQsp2oBf"}],"key":"Vyk585q0R9"},{"type":"paragraph","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"children":[{"type":"strong","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"children":[{"type":"text","value":"Note","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"key":"EwzfLy5rqK"}],"key":"rH18dfZ9sx"},{"type":"text","value":" - this dataset and a few others can be found on the NIH website ","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"key":"NzfJvdiVaB"},{"type":"link","url":"https://report.nih.gov/funding/nih-budget-and-spending-data-past-fiscal-years/success-rates","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"children":[{"type":"text","value":"here","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"key":"R52pYTjC0Y"}],"urlSource":"https://report.nih.gov/funding/nih-budget-and-spending-data-past-fiscal-years/success-rates","key":"IcfUR3CLyN"},{"type":"text","value":". I encourage you to check it out! Thank god for open data (even if it’s really hard to find).","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"key":"qvjBwYtQ88"}],"key":"hNYPHlbTdp"}],"key":"oDPGPhR5fX"},{"type":"block","kind":"notebook-code","data":{"collapsed":true},"children":[{"type":"code","lang":"python","executable":true,"value":"# First we'll import a few helpful tools for cleaning and plotting\nimport pandas as pd\nfrom matplotlib import pyplot as plt\nimport seaborn as sns\nimport re\nimport numpy as np\n%matplotlib inline","key":"vqwKQ0Ux3F"},{"type":"output","id":"VJLs5sG-mAysY6RMQ4Qla","data":[],"key":"gqbJpNscJ3"}],"key":"VTiXAZopxO"},{"type":"block","kind":"notebook-code","data":{"collapsed":false},"children":[{"type":"code","lang":"python","executable":true,"value":"# Load the data - note that each row is a grant type/year/agency\ndata = pd.read_excel('./data/nih_nrsa_success_rates.xls', header=2)\ndata = data.convert_objects(convert_numeric=True)\ndata.head()","key":"GoXDsCw5ZQ"},{"type":"output","id":"UXoDlD57jxaokrD7dhJev","data":[{"output_type":"execute_result","execution_count":7,"metadata":{},"data":{"application/vnd.code.notebook.error":{"content":"{\"message\":\"INVALID mime type: text_plain. Must be in the format \\\"type/subtype[;optionalparameter]\\\"\",\"name\":\"Error\",\"stack\":\"Error: INVALID mime type: text_plain. Must be in the format \\\"type/subtype[;optionalparameter]\\\"\\n\\tat new Mt (/home/choldgraf/.vscode-server/bin/6261075646f055b99068d3688932416f2346dd3b/out/vs/workbench/api/node/extensionHostProcess.js:90:58979)\\n\\tat Function.text (/home/choldgraf/.vscode-server/bin/6261075646f055b99068d3688932416f2346dd3b/out/vs/workbench/api/node/extensionHostProcess.js:90:58777)\\n\\tat i (/home/choldgraf/.vscode-server/bin/6261075646f055b99068d3688932416f2346dd3b/extensions/ipynb/dist/ipynbMain.js:1:143384)\\n\\tat l (/home/choldgraf/.vscode-server/bin/6261075646f055b99068d3688932416f2346dd3b/extensions/ipynb/dist/ipynbMain.js:1:144160)\\n\\tat h (/home/choldgraf/.vscode-server/bin/6261075646f055b99068d3688932416f2346dd3b/extensions/ipynb/dist/ipynbMain.js:1:144910)\\n\\tat Array.map (<anonymous>)\\n\\tat /home/choldgraf/.vscode-server/bin/6261075646f055b99068d3688932416f2346dd3b/extensions/ipynb/dist/ipynbMain.js:1:146078\\n\\tat /home/choldgraf/.vscode-server/bin/6261075646f055b99068d3688932416f2346dd3b/extensions/ipynb/dist/ipynbMain.js:1:146395\\n\\tat /home/choldgraf/.vscode-server/bin/6261075646f055b99068d3688932416f2346dd3b/extensions/ipynb/dist/ipynbMain.js:1:146402\\n\\tat Array.map (<anonymous>)\\n\\tat e.jupyterNotebookModelToNotebookData (/home/choldgraf/.vscode-server/bin/6261075646f055b99068d3688932416f2346dd3b/extensions/ipynb/dist/ipynbMain.js:1:145654)\\n\\tat e.NotebookSerializer.deserializeNotebook (/home/choldgraf/.vscode-server/bin/6261075646f055b99068d3688932416f2346dd3b/extensions/ipynb/dist/ipynbMain.js:1:156280)\\n\\tat f.$dataToNotebook (/home/choldgraf/.vscode-server/bin/6261075646f055b99068d3688932416f2346dd3b/out/vs/workbench/api/node/extensionHostProcess.js:94:98450)\\n\\tat l._doInvokeHandler (/home/choldgraf/.vscode-server/bin/6261075646f055b99068d3688932416f2346dd3b/out/vs/workbench/api/node/extensionHostProcess.js:102:13680)\\n\\tat l._invokeHandler (/home/choldgraf/.vscode-server/bin/6261075646f055b99068d3688932416f2346dd3b/out/vs/workbench/api/node/extensionHostProcess.js:102:13362)\\n\\tat l._receiveRequest (/home/choldgraf/.vscode-server/bin/6261075646f055b99068d3688932416f2346dd3b/out/vs/workbench/api/node/extensionHostProcess.js:102:12081)\\n\\tat l._receiveOneMessage (/home/choldgraf/.vscode-server/bin/6261075646f055b99068d3688932416f2346dd3b/out/vs/workbench/api/node/extensionHostProcess.js:102:11033)\\n\\tat /home/choldgraf/.vscode-server/bin/6261075646f055b99068d3688932416f2346dd3b/out/vs/workbench/api/node/extensionHostProcess.js:102:8941\\n\\tat h.invoke (/home/choldgraf/.vscode-server/bin/6261075646f055b99068d3688932416f2346dd3b/out/vs/workbench/api/node/extensionHostProcess.js:61:145)\\n\\tat v.deliver (/home/choldgraf/.vscode-server/bin/6261075646f055b99068d3688932416f2346dd3b/out/vs/workbench/api/node/extensionHostProcess.js:61:2266)\\n\\tat g.fire (/home/choldgraf/.vscode-server/bin/6261075646f055b99068d3688932416f2346dd3b/out/vs/workbench/api/node/extensionHostProcess.js:61:1844)\\n\\tat r.fire (/home/choldgraf/.vscode-server/bin/6261075646f055b99068d3688932416f2346dd3b/out/vs/workbench/api/node/extensionHostProcess.js:70:16515)\\n\\tat /home/choldgraf/.vscode-server/bin/6261075646f055b99068d3688932416f2346dd3b/out/vs/workbench/api/node/extensionHostProcess.js:118:17104\\n\\tat h.invoke (/home/choldgraf/.vscode-server/bin/6261075646f055b99068d3688932416f2346dd3b/out/vs/workbench/api/node/extensionHostProcess.js:61:145)\\n\\tat v.deliver (/home/choldgraf/.vscode-server/bin/6261075646f055b99068d3688932416f2346dd3b/out/vs/workbench/api/node/extensionHostProcess.js:61:2266)\\n\\tat g.fire (/home/choldgraf/.vscode-server/bin/6261075646f055b99068d3688932416f2346dd3b/out/vs/workbench/api/node/extensionHostProcess.js:61:1844)\\n\\tat r.fire (/home/choldgraf/.vscode-server/bin/6261075646f055b99068d3688932416f2346dd3b/out/vs/workbench/api/node/extensionHostProcess.js:70:16515)\\n\\tat o._receiveMessage (/home/choldgraf/.vscode-server/bin/6261075646f055b99068d3688932416f2346dd3b/out/vs/workbench/api/node/extensionHostProcess.js:70:21327)\\n\\tat /home/choldgraf/.vscode-server/bin/6261075646f055b99068d3688932416f2346dd3b/out/vs/workbench/api/node/extensionHostProcess.js:70:18770\\n\\tat h.invoke (/home/choldgraf/.vscode-server/bin/6261075646f055b99068d3688932416f2346dd3b/out/vs/workbench/api/node/extensionHostProcess.js:61:145)\\n\\tat v.deliver (/home/choldgraf/.vscode-server/bin/6261075646f055b99068d3688932416f2346dd3b/out/vs/workbench/api/node/extensionHostProcess.js:61:2266)\\n\\tat g.fire (/home/choldgraf/.vscode-server/bin/6261075646f055b99068d3688932416f2346dd3b/out/vs/workbench/api/node/extensionHostProcess.js:61:1844)\\n\\tat g.acceptChunk (/home/choldgraf/.vscode-server/bin/6261075646f055b99068d3688932416f2346dd3b/out/vs/workbench/api/node/extensionHostProcess.js:70:13346)\\n\\tat /home/choldgraf/.vscode-server/bin/6261075646f055b99068d3688932416f2346dd3b/out/vs/workbench/api/node/extensionHostProcess.js:70:12476\\n\\tat h.invoke (/home/choldgraf/.vscode-server/bin/6261075646f055b99068d3688932416f2346dd3b/out/vs/workbench/api/node/extensionHostProcess.js:61:145)\\n\\tat v.deliver (/home/choldgraf/.vscode-server/bin/6261075646f055b99068d3688932416f2346dd3b/out/vs/workbench/api/node/extensionHostProcess.js:61:2266)\\n\\tat g.fire (/home/choldgraf/.vscode-server/bin/6261075646f055b99068d3688932416f2346dd3b/out/vs/workbench/api/node/extensionHostProcess.js:61:1844)\\n\\tat g._processReadQueue (/home/choldgraf/.vscode-server/bin/6261075646f055b99068d3688932416f2346dd3b/out/vs/workbench/api/node/extensionHostProcess.js:70:32036)\\n\\tat g.acceptFrame (/home/choldgraf/.vscode-server/bin/6261075646f055b99068d3688932416f2346dd3b/out/vs/workbench/api/node/extensionHostProcess.js:70:31692)\\n\\tat h._acceptChunk (/home/choldgraf/.vscode-server/bin/6261075646f055b99068d3688932416f2346dd3b/out/vs/workbench/api/node/extensionHostProcess.js:70:29656)\\n\\tat /home/choldgraf/.vscode-server/bin/6261075646f055b99068d3688932416f2346dd3b/out/vs/workbench/api/node/extensionHostProcess.js:70:26841\\n\\tat Socket.i (/home/choldgraf/.vscode-server/bin/6261075646f055b99068d3688932416f2346dd3b/out/vs/workbench/api/node/extensionHostProcess.js:70:24594)\\n\\tat Socket.emit (node:events:526:28)\\n\\tat addChunk (node:internal/streams/readable:315:12)\\n\\tat readableAddChunk (node:internal/streams/readable:289:9)\\n\\tat Socket.Readable.push (node:internal/streams/readable:228:10)\\n\\tat TCP.onStreamRead (node:internal/stream_base_commons:190:23)\"}","content_type":"application/vnd.code.notebook.error"},"text/html":{"content":"<div>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>Fiscal Year</th>\n      <th>Activity Code</th>\n      <th>NIH Institute/Center</th>\n      <th>Number of Applications Reviewed</th>\n      <th>Number of Applications Awarded</th>\n      <th>Success Rate2</th>\n      <th>Total Funding3</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>2005</td>\n      <td>F05</td>\n      <td>NCCAM</td>\n      <td>7</td>\n      <td>2</td>\n      <td>0.285714</td>\n      <td>123572</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>2005</td>\n      <td>F05</td>\n      <td>NINDS</td>\n      <td>4</td>\n      <td>3</td>\n      <td>0.750000</td>\n      <td>163368</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>2005</td>\n      <td>F05</td>\n      <td>Total</td>\n      <td>11</td>\n      <td>5</td>\n      <td>0.454545</td>\n      <td>286940</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>2005</td>\n      <td>F30</td>\n      <td>NIDA</td>\n      <td>11</td>\n      <td>6</td>\n      <td>0.545455</td>\n      <td>189408</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>2005</td>\n      <td>F30</td>\n      <td>NIDCD</td>\n      <td>7</td>\n      <td>2</td>\n      <td>0.285714</td>\n      <td>53713</td>\n    </tr>\n  </tbody>\n</table>\n</div>","content_type":"text/html"},"text/plain":{"content":"   Fiscal Year Activity Code NIH Institute/Center  \\\n0         2005           F05                NCCAM   \n1         2005           F05                NINDS   \n2         2005           F05                Total   \n3         2005           F30                 NIDA   \n4         2005           F30                NIDCD   \n\n   Number of Applications Reviewed   Number of Applications Awarded  \\\n0                                 7                               2   \n1                                 4                               3   \n2                                11                               5   \n3                                11                               6   \n4                                 7                               2   \n\n   Success Rate2  Total Funding3  \n0       0.285714          123572  \n1       0.750000          163368  \n2       0.454545          286940  \n3       0.545455          189408  \n4       0.285714           53713  ","content_type":"text/plain"}}}],"key":"Hdp3XdEq72"}],"key":"WvdFrxUpQc"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"First, we’ll do some cleaning to remove annoying things like special characters and spaces. We’ll focus on the “success rate2” variable, which describes the % of proposals that were funded that year.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"iAyeyIF5aL"}],"key":"OASjjKI1Z6"}],"key":"drBdpd08cP"},{"type":"block","kind":"notebook-code","data":{"collapsed":false},"children":[{"type":"code","lang":"python","executable":true,"value":"# Make the columns easier to play with\ncol_mapping = {col: col.strip(' ').replace(' ', '_').replace('/', '_').\\\n               strip().\\\n               lower() for col in data.columns}\ndata = data.rename(columns=col_mapping)\n\n# Remove missing values for success rate\ndata = data.dropna(subset=['success_rate2',\n                           'fiscal_year',\n                           'nih_institute_center'])\n\n# Remove all non-word characters from names\ndata['nih_institute_center'] = data['nih_institute_center'].\\\n    apply(lambda a: re.sub('[^a-zA-Z]', '', a))\n\n# Remove center values that aren't as useful\nremove_centers = [\"Total\", \"ODOther\"]\ndata = data.query('nih_institute_center not in @remove_centers')","key":"UOeZcVRmT3"},{"type":"output","id":"icPZXjQ4XePSnp9onBnhT","data":[],"key":"DtKP1MCwYI"}],"key":"BdVAWYPAr2"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"First, let’s take a look at some general trends over time","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"EyVk5D518C"}],"key":"nQeJzMEKcI"}],"key":"hOxajuC9QA"},{"type":"block","kind":"notebook-code","data":{"collapsed":false},"children":[{"type":"code","lang":"python","executable":true,"value":"f, axs = plt.subplots(3, 1, figsize=(8, 9))\ncombined = data.groupby('fiscal_year').sum()\ncoltypes = ['number_of_applications_reviewed',\n            'number_of_applications_awarded',\n            'total_funding3']\nfor ax, coltype in zip(axs, coltypes):\n    combined[coltype].plot.bar(ax=ax)\n    ax.set_title(coltype, fontsize=20)\nplt.tight_layout()","key":"Vt6F95dpX3"},{"type":"output","id":"1S3TeXk3QOAM48EYEuprv","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"4289910370300951582dd537f1a6c898","path":"/build/4289910370300951582dd537f1a6c898.png"}}}],"key":"nViiWqYNsc"}],"key":"HC6tItjN6H"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Eyeballing it, it looks like applications have been slightly increasing per year, while applications awarded have remained relatively flat. Let’s dig into that a little bit more. Rather than looking at the raw numbers, we’ll focus on the success rate, or the % of applications that were funded.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"BS317HBlbs"}],"key":"vMzWiQ1Coc"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"We’ll plot the success rates per year, per activity code. I’ll plot a scatter + line for each NIH institute (in color) as well as the mean + a 3rd order polynomial fit for all of them lumped together (in black)","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"HidzMJ74sE"}],"key":"SR3aii4pBi"}],"key":"oOQ4F5SLUw"},{"type":"block","kind":"notebook-code","data":{"collapsed":false,"scrolled":false},"children":[{"type":"code","lang":"python","executable":true,"value":"for grant, gvals in data.groupby('activity_code'):\n    if gvals.shape[0] > 10:\n        mn_grp = gvals.groupby('fiscal_year').mean()\n        lm = sns.lmplot('fiscal_year', 'success_rate2', data=gvals,\n                        hue='nih_institute_center', ci=None,\n                        line_kws={'alpha': .5}, scatter_kws={'alpha': .5},\n                        legend=False)\n        ax = lm.ax\n        ax.figure.set_size_inches(6, 4)\n\n        # If we have enough data, fit a fancier function to all points\n        if gvals.shape[0] > 10:\n            mn_reg = sns.regplot(\n                'fiscal_year', 'success_rate2', data=gvals,\n                scatter=False, line_kws={'linewidth': 5, 'c': 'k'},\n                order=3)\n        ax.set_title('Grant Activity Code: {0}'.format(grant), fontsize=20)\n        ax.set(ylim=[0, 1])\n        _ = plt.setp(mn_reg.collections[-1], color='k', alpha=.1)\n        ax.legend(loc='right', bbox_to_anchor=(1.2, .5),\n          ncol=1, fancybox=True, shadow=True, frameon=False, fontsize=8)\n        plt.tight_layout()","key":"dlhPxFLWy8"},{"type":"output","id":"Z0mxOdRtMA56Hpge96_gs","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"1ded17f002609ce43916c3225eb7ef91","path":"/build/1ded17f002609ce43916c3225eb7ef91.png"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"2b2d73f6fd7a4bc0f8d64ad55e801daf","path":"/build/2b2d73f6fd7a4bc0f8d64ad55e801daf.png"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"2b44633d9f0c4e2080ec1887be29b954","path":"/build/2b44633d9f0c4e2080ec1887be29b954.png"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"af7d013b23bad1f2bb64bd81a9386e07","path":"/build/af7d013b23bad1f2bb64bd81a9386e07.png"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"c15893e49382709d624aeff0aafea885","path":"/build/c15893e49382709d624aeff0aafea885.png"}}}],"key":"D44oPPAJaq"}],"key":"xn0befysFG"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"As you can see - some of these data aren’t well-modeled by a line in the first place. That’s because there’s a lot of missing data in here. However, especially for the more common grants (F31, F32) you can see some interesting (and mostly downward) trends.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vuKrY9fLa3"}],"key":"OGBNKrDQxo"},{"type":"heading","depth":2,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Digging in to specific grants","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"FBKPDHZFVY"}],"identifier":"digging-in-to-specific-grants","label":"Digging in to specific grants","html_id":"digging-in-to-specific-grants","implicit":true,"key":"q99RvGodY8"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Next, we’ll take a look at some more specific information about a select grant type. I’ll focus on the F31 and F32 because that’s most related to what I’m applying for.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"FWGzG53liH"}],"key":"IH8n40dHKh"}],"key":"DKMSlKQKiU"},{"type":"block","kind":"notebook-code","data":{"collapsed":false},"children":[{"type":"code","lang":"python","executable":true,"value":"# Pull the subset of data we want\ngrant_type = ['F31', 'F32']\nsubset = data.query('activity_code in @grant_type')\n\n# Average out the grant type column\nsubset = subset.groupby(['fiscal_year', 'nih_institute_center']).mean().reset_index()","key":"tgFc5NjxSc"},{"type":"output","id":"ySy7H8nZlyvgjpwEQBnSF","data":[],"key":"VYCXCm1h2L"}],"key":"aubpZUjiNj"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We’ll plot the successrate (y-axis) as a function of year (color) for each NIH center (x-axis).","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"pNCaBEPoY6"}],"key":"lfyFqfWwrW"}],"key":"P2L2VxjAgl"},{"type":"block","kind":"notebook-code","data":{"collapsed":false},"children":[{"type":"code","lang":"python","executable":true,"value":"variable_types = ['success_rate2', 'number_of_applications_reviewed']\nn_yrs = len(subset.fiscal_year.unique())\npal = sns.color_palette('RdBu_r', n_colors=n_yrs)\nfor var in variable_types:\n    f, ax = plt.subplots(figsize=(8, 4))\n    sns.barplot(x='nih_institute_center', y=var,\n                data=subset, hue='fiscal_year', palette=pal)\n    _ = plt.setp(ax.get_xticklabels(), rotation=90, fontsize=15)\n    _ = plt.setp(ax.get_yticklabels(), fontsize=15)\n    ax.legend(loc='right', bbox_to_anchor=(1.15, .5),\n          ncol=1, fancybox=True, shadow=True, frameon=False, fontsize=8)\n    ax.set_title(var, fontsize=20)","key":"dVBU42Amwp"},{"type":"output","id":"D_3XcmZuN56jfRyBEAHCY","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"918b03ff970c2417d3bbf4665876733e","path":"/build/918b03ff970c2417d3bbf4665876733e.png"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"c8e463f46df9f88537e6273b88c3f212","path":"/build/c8e463f46df9f88537e6273b88c3f212.png"}}}],"key":"tn0MWLlQjd"}],"key":"R2D3OcSeEQ"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Is there anything that we can learn from this? Let’s look at how the finding changed for each year:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"c3Ri8VB2PB"}],"key":"LJVBxddQlU"}],"key":"huVMTYoILC"},{"type":"block","kind":"notebook-code","data":{"collapsed":false},"children":[{"type":"code","lang":"python","executable":true,"value":"yearly_change = subset.set_index(['nih_institute_center', 'fiscal_year'])['success_rate2'].\\\n    unstack('nih_institute_center')","key":"jB9WQ1vaXl"},{"type":"output","id":"GNXBisjceo5cEpZ3SmmBf","data":[],"key":"lHI9otu8pM"}],"key":"pGWObVQ5qE"},{"type":"block","kind":"notebook-code","data":{"collapsed":false},"children":[{"type":"code","lang":"python","executable":true,"value":"sns.set_palette(sns.color_palette('rainbow', yearly_change.shape[1]))\nax = yearly_change.plot(figsize=(10, 5))\nax.legend(loc='upper center', bbox_to_anchor=(0.5, 1.05),\n          ncol=7, fancybox=True, shadow=True, frameon=True)","key":"bNpO5hnn6P"},{"type":"output","id":"A25RQl3i_jge12HJDsiul","data":[{"output_type":"execute_result","execution_count":14,"metadata":{},"data":{}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"c8ec286d16dc37699553b2a2f09c081b","path":"/build/c8ec286d16dc37699553b2a2f09c081b.png"}}}],"key":"RT8bU1ISLv"}],"key":"yIfbHkf5zm"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"To make things more comparable, we can normalize each timeseries by its first value, this will give everything the same starting point. We’ll also smooth the curves a little bit to get an idea for general trends. We’ll apply an exponentially-weighted moving average so recent points factor more into the average","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"datGE6osys"}],"key":"eibm0osF2U"}],"key":"J2VrDDB1MQ"},{"type":"block","kind":"notebook-code","data":{"collapsed":false},"children":[{"type":"code","lang":"python","executable":true,"value":"# Normalize data and apply a bit of smoothing\nyearly_change_norm = yearly_change / yearly_change.iloc[0]\nax = yearly_change_norm.apply(pd.stats.moments.ewma, span=5).\\\n    plot(figsize=(10, 5))\nax.legend(loc='upper center', bbox_to_anchor=(0.5, 1.05),\n          ncol=7, fancybox=True, shadow=True, frameon=True)","key":"i73bbJyRlz"},{"type":"output","id":"4Oss8v3NBJiyg1XzTQ_at","data":[{"output_type":"execute_result","execution_count":15,"metadata":{},"data":{}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"1c3b2ef22771c6510cdd475a0356c731","path":"/build/1c3b2ef22771c6510cdd475a0356c731.png"}}}],"key":"DJqrU4hobS"}],"key":"OMD3IXGWiY"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"It seems like some NIH groups have made out better than others. Maybe this simply because the number of total applications each received changed from one year to another.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"FgKQKiVHSU"}],"key":"eFlAMEgwwl"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"As a final analysis, we can look at how the yearly change in applications is correlated with a success rate.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ICLKfFYF2m"}],"key":"rcKYH9xcDb"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Positive lines mean that more applications tend to have a higher success rate, negative lines mean more apps have a lower success rate. I’ll also color each point by the fiscal year it came from - hotter colors mean more recent years.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"ih29TA1XSB"}],"key":"lTaCvieFkT"}],"key":"f1GUbStd0U"},{"type":"block","kind":"notebook-code","data":{"collapsed":false,"scrolled":false},"children":[{"type":"code","lang":"python","executable":true,"value":"grp_cent = subset.groupby('nih_institute_center')\nn_cl = 4\nn_rw = np.ceil(len(grp_cent) / float(n_cl)).astype(int)\nf, axs = plt.subplots(n_rw, n_cl, figsize=(3*n_cl, 2*n_rw))\nfor (cent, vals), ax in zip(grp_cent, axs.ravel()):\n    yr = vals['fiscal_year'] / 100\n    corr = np.corrcoef(*vals[['number_of_applications_reviewed', 'success_rate2']].values.T)[1, 0]\n    lc = str(np.where(corr > 0, 'g', 'r'))\n    sns.regplot('number_of_applications_reviewed', 'success_rate2',\n                data=vals, ax=ax, scatter_kws={'s': yr*5, 'c': yr, 'cmap': plt.cm.RdBu_r},\n                line_kws={'c': lc}, ci=None)\n    ax.set(ylim=[-.1, .8])\n#     sns.corrplot(vals.set_index(['fiscal_year']), cbar=False, ax=ax)\n    ax.set_title(cent, fontsize=10)\n    ax.annotate('Corr: {0: .02f}'.format(corr), (.1, .9),\n                xycoords='axes fraction', fontsize=10)\nplt.tight_layout()\n_ = plt.setp([ax.get_xticklabels() + ax.get_yticklabels()\n              for ax in axs.ravel()], fontsize=10)\n_ = plt.setp([ax.xaxis.label, ax.yaxis.label], fontsize=10)","key":"QN0DNg69oY"},{"type":"output","id":"bCCjy6uyDwdEwqgBYSnuD","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"5cb29288f612dd8991e40b3c7306b660","path":"/build/5cb29288f612dd8991e40b3c7306b660.png"}}}],"key":"z49ux5Ia0B"}],"key":"uP6racEeLo"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"So what did we learn from any of this? Well, it seems like the funding landscape at the NIH is changing, and some groups are making out better than others.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"J6eqf50zaw"}],"key":"jKT5oONnNr"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"There are power players who’ve been around for a while, like the NINDS, who haven’t seen a huge change in their granting behavior. Other groups, such as NIAAA, have seen their success rates decline steadily w/ increased applications. On the other hand, there are some centers that have actually shown both an increase in applications AND an increase in success rates (such as the NHGRI), which may reflect increased interest in those research endeavors from congress etc.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"QpT9DnZifa"}],"key":"VedvvG6vGL"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"There’s a lot more to be read into this data, so I encourage people to check it out for themselves, or suggest things to try out on top of what’s already here. It’s been fun learning a bit about the landscape of grants at the NIH.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"pNz8vUHmtq"}],"key":"jN0j9McLg7"}],"key":"eGEVaUvjd5"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Appendix","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"SghGb2YpIc"}],"identifier":"appendix","label":"Appendix","html_id":"appendix","implicit":true,"key":"ftJni1gFrr"},{"type":"heading","depth":3,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"NIH acronym lookup","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"okgJsGzwMy"}],"identifier":"nih-acronym-lookup","label":"NIH acronym lookup","html_id":"nih-acronym-lookup","implicit":true,"key":"RaVRnlPCL8"}],"key":"ZutkEjXUYv"},{"type":"block","kind":"notebook-code","data":{"collapsed":false},"children":[{"type":"code","lang":"python","executable":true,"value":"data['nih_institute_center'].unique()\nnih_centers = {u'NCCAM': 'National Center for Complementary and Alternative Medicine',\n                 u'NINDS': 'National Institute on Neurological Disorders and Stroke',\n                 u'NIDA': 'National Institute on Drug Abuse',\n                 u'NIDCD': 'National Institute on Deafness and Other Communication Disorders',\n                 u'NIDCR': 'National Institute of Dental and Craniofacial Research',\n                 u'NIEHS': 'National Institute of Environmental Health Sciences',\n                 u'NIMH':  'National Institute of Mental Health',\n                 u'NIAAA': 'National Institute on Alcohol Abuse and Alcoholism',\n                 u'NIA': 'National Institute on Aging',\n                 u'NIAID': 'National Institute of Allergy and Infectious Diseases',\n                 u'NIAMS': 'National Institute of Arthritis and Musculoskeletal and Skin Diseases',\n                 u'NCI': 'National Cancer Institute',\n                 u'NIDDK': 'National Institute of Diabetes and Digestive and Kidney Diseases',\n                 u'NIBIB': 'National Institute of Biomedical Imaging and Bioengineering',\n                 u'NEI': 'National Eye Institute',\n                 u'NIGMS': 'National Institute of General Medical Sciences',\n                 u'NICHD': 'National Institute of Child Health and Human Development',\n                 u'NHGRI': 'National Human Genome Research Institute',\n                 u'NHLBI': 'National Heart, Lung, and Bloog Institute',\n                 u'NINR': 'National Institute of Nursing Research',\n                 u'NCRR': 'National Center for Research Resources',\n                 u'NLM': 'National Library of Medicine'}\nfor ac, cent in nih_centers.iteritems():\n    print('{0}:\\t{1}'.format(ac, cent))","key":"Nl1ROeqcSJ"},{"type":"output","id":"2vz40TzYSGTzEUrCbL7-w","data":[],"key":"Qsnz4ADWOV"}],"key":"xZv5BOvH3m"}],"key":"IOiQfDYJnX"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Craigslist data analysis","url":"/blog/2015/2015-09-27-craigslist-data-analysis","group":"2015"}}},"domain":"http://localhost:3000"}