{"kind":"Article","sha256":"56c04951a73aec7e68e9f81b3bc4c6a284ce500c006cb3a48946e9c27f5cc7ba","slug":"blog.2018.sphinx-copy-buttons","location":"/blog/2018/sphinx-copy-buttons.md","dependencies":[],"frontmatter":{"title":"Adding copy buttons to code blocks in Sphinx","tags":["python","blogging","sphinx","documentation"],"date":"2018-07-05","content_includes_title":false,"github":"https://github.com/choldgraf/choldgraf.github.io","exports":[{"format":"md","filename":"sphinx-copy-buttons.md","url":"/build/sphinx-copy-buttons-912e830499625a664f6fb8e8d9988fde.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"blockquote","position":{"start":{"line":14,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":14,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"strong","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"NOTE: This is now a sphinx extension!","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"oCwMtjOxNu"}],"key":"orDbNUK4ca"},{"type":"text","value":" Thanks to some friendly suggestions, I’ve written\nthis up as a super tiny sphinx extension. Check it out here: ","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"Iw8jTM8Dqy"},{"type":"link","url":"https://github.com/choldgraf/sphinx-copybutton","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"https://​github​.com​/choldgraf​/sphinx​-copybutton","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"Du0zWSegnn"}],"urlSource":"https://github.com/choldgraf/sphinx-copybutton","error":true,"key":"UxP738qn3W"}],"key":"PcZlkLGrCI"}],"key":"I8bLldbrvT"},{"type":"paragraph","position":{"start":{"line":17,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"link","url":"http://www.sphinx-doc.org/en/master/","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"Sphinx","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"RVc9ceB9bz"}],"urlSource":"http://www.sphinx-doc.org/en/master/","key":"agX1MVSmmV"},{"type":"text","value":" is a fantastic way to build\ndocumentation for your Python package. On the Jupyter project, we use it\nfor almost all of our repositories.","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"ElE25ZFbqJ"}],"key":"gjvrXxVqM3"},{"type":"paragraph","position":{"start":{"line":21,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"A common use for Sphinx is to step people through a chunk of code. For example,\nin the ","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"r6qZPBLsvo"},{"type":"link","url":"https://zero-to-jupyterhub.readthedocs.io/en/latest/","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"Zero to JupyterHub for Kubernetes","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"dIBI95wdRj"}],"urlSource":"https://zero-to-jupyterhub.readthedocs.io/en/latest/","key":"UucseoM2fN"},{"type":"text","value":"\nguide we step users through a number of installation and configuration steps.","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"vXcn9WuEgf"}],"key":"DhMpAowoRJ"},{"type":"paragraph","position":{"start":{"line":25,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"text","value":"A common annoyance is that there is a lot of copy/pasting involved. Sometimes\nyou accidentally miss a character or some whitespace. So, I spent a bit of time\nfiguring out how to ","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"uJ4BEVDA2o"},{"type":"strong","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"text","value":"automatically embed a copy button into code blocks","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"YARy3ZWev2"}],"key":"XCupH3hWCM"},{"type":"text","value":". It\nturns out this is pretty easy!","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"nSYBmy3R0d"}],"key":"iz2rPzG53L"},{"type":"paragraph","position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"children":[{"type":"text","value":"Here’s what the final result will look like (just hover the code block below)","position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"key":"eG7w83xvKf"}],"key":"AQu6dJgXkK"},{"type":"code","lang":"python","value":"wow = this_text\nis_so = much*more*copyable","position":{"start":{"line":32,"column":1},"end":{"line":35,"column":1}},"key":"rLrxeWFgtg"},{"type":"heading","depth":2,"position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"children":[{"type":"text","value":"Adding a copy button to your Sphinx code blocks","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"xDPTI5BIQI"}],"identifier":"adding-a-copy-button-to-your-sphinx-code-blocks","label":"Adding a copy button to your Sphinx code blocks","html_id":"adding-a-copy-button-to-your-sphinx-code-blocks","implicit":true,"key":"yjwFCoXioq"},{"type":"paragraph","position":{"start":{"line":41,"column":1},"end":{"line":43,"column":1}},"children":[{"type":"text","value":"To accomplish this we’ll use the excellent ","position":{"start":{"line":41,"column":1},"end":{"line":41,"column":1}},"key":"xOqiawUSSY"},{"type":"link","url":"https://clipboardjs.com/","position":{"start":{"line":41,"column":1},"end":{"line":41,"column":1}},"children":[{"type":"text","value":"clipboard.js","position":{"start":{"line":41,"column":1},"end":{"line":41,"column":1}},"key":"uotN6Rg6F6"}],"urlSource":"https://clipboardjs.com/","key":"rmrl4U4Gqf"},{"type":"text","value":"\nwhich provides the machinery for copying the contents of an HTML element as well\nas ","position":{"start":{"line":41,"column":1},"end":{"line":41,"column":1}},"key":"g1qN6vyp4T"},{"type":"link","url":"https://jquery.com/","position":{"start":{"line":41,"column":1},"end":{"line":41,"column":1}},"children":[{"type":"text","value":"jquery","position":{"start":{"line":41,"column":1},"end":{"line":41,"column":1}},"key":"M79iHY04lM"}],"urlSource":"https://jquery.com/","key":"FN9FyKWUL0"},{"type":"text","value":" for modifying our built documentation on-demand.","position":{"start":{"line":41,"column":1},"end":{"line":41,"column":1}},"key":"eBOs7EjGSr"}],"key":"Ht5PSgDzSL"},{"type":"paragraph","position":{"start":{"line":45,"column":1},"end":{"line":47,"column":1}},"children":[{"type":"text","value":"The result will be a Sphinx site with code blocks that display a copy button\nwhen you hover over them. You can see how it looks on this very page, which uses a\nsimilar method (but is built with Jekyll).","position":{"start":{"line":45,"column":1},"end":{"line":45,"column":1}},"key":"fi3hzLie1A"}],"key":"cwLufXnWNn"},{"type":"paragraph","position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"children":[{"type":"text","value":"Here’s what you should do:","position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"key":"BVx9GeNlDg"}],"key":"Keh4vGRVmj"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":51,"column":1},"end":{"line":107,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":51,"column":1},"end":{"line":82,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":51,"column":1},"end":{"line":53,"column":1}},"children":[{"type":"strong","position":{"start":{"line":51,"column":1},"end":{"line":51,"column":1}},"children":[{"type":"text","value":"Add the clipboard.js javascript","position":{"start":{"line":51,"column":1},"end":{"line":51,"column":1}},"key":"XhmCimeh7M"}],"key":"GHXedEqsYG"},{"type":"text","value":". Create a javascript\nscript called ","position":{"start":{"line":51,"column":1},"end":{"line":51,"column":1}},"key":"lIcAygwf85"},{"type":"inlineCode","value":"doc/_static/custom.js","position":{"start":{"line":51,"column":1},"end":{"line":51,"column":1}},"key":"WoyiqZ2lMy"},{"type":"text","value":". In the file, put the following\ncode (see comments for explanation):","position":{"start":{"line":51,"column":1},"end":{"line":51,"column":1}},"key":"B3CLmQn9It"}],"key":"zsPtV3oPlw"},{"type":"code","lang":"javascript","value":"function addCopyButtonToCode(){\n// get all code elements\nvar allCodeBlocksElements = $( \"div.highlight pre\" );\n\n// For each element, do the following steps\nallCodeBlocksElements.each(function(ii) {\n// define a unique id for this element and add it\nvar currentId = \"codeblock\" + (ii + 1);\n$(this).attr('id', currentId);\n\n// create a button that's configured for clipboard.js\n// point it to the text that's in this code block\n// add the button just after the text in the code block w/ jquery\nvar clipButton = '<button class=\"btn copybtn\" data-clipboard-target=\"#' + currentId + '\"><img src=\"https://clipboardjs.com/assets/images/clippy.svg\" width=\"13\" alt=\"Copy to clipboard\"></button>';\n   $(this).after(clipButton);\n});\n\n// tell clipboard.js to look for clicks that match this query\nnew Clipboard('.btn');\n}\n\n$(document).ready(function () {\n// Once the DOM is loaded for the page, attach clipboard buttons\naddCopyButtonToCode();\n});","position":{"start":{"line":55,"column":1},"end":{"line":81,"column":1}},"key":"x39FGk7Agw"}],"key":"FB63uwCmo3"},{"type":"listItem","spread":true,"position":{"start":{"line":83,"column":1},"end":{"line":107,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":83,"column":1},"end":{"line":85,"column":1}},"children":[{"type":"strong","position":{"start":{"line":83,"column":1},"end":{"line":83,"column":1}},"children":[{"type":"text","value":"Add some CSS to make it pretty","position":{"start":{"line":83,"column":1},"end":{"line":83,"column":1}},"key":"dXOXPmwSqP"}],"key":"gtLb3M7je1"},{"type":"text","value":". Create a custom CSS file\ncalled ","position":{"start":{"line":83,"column":1},"end":{"line":83,"column":1}},"key":"ijP0HqFAQv"},{"type":"inlineCode","value":"doc/_static/custom.css","position":{"start":{"line":83,"column":1},"end":{"line":83,"column":1}},"key":"W93JIRWqPX"},{"type":"text","value":" (or add to one you’ve\nalready got). In the file, put these lines:","position":{"start":{"line":83,"column":1},"end":{"line":83,"column":1}},"key":"OEAZBI1f5N"}],"key":"PdAMR7WCsu"},{"type":"code","lang":"css","value":"/* Copy buttons */\nbutton.copybtn {\n  webkit-transition: opacity .3s ease-in-out;\n  -o-transition: opacity .3s ease-in-out;\n  transition: opacity .3s ease-in-out;\n  opacity: 0;\n  padding: 2px 6px;\n  position: absolute;\n  right: 4px;\n  top: 4px;\n}\ndiv.highlight:hover .copybtn, div.highlight .copybtn:focus {\n    opacity: .3;\n}\ndiv.highlight .copybtn:hover {\n    opacity: 1;\n}\ndiv.highlight {\n    position: relative;\n}","position":{"start":{"line":87,"column":1},"end":{"line":107,"column":1}},"key":"cy6nduSuJN"}],"key":"uRNnVkIirG"}],"key":"riR5zWqAYQ"},{"type":"code","lang":"","value":"\n3. **Link these scripts in your configuration.** You need to link your\n custom JS and CSS scripts, as well as the clipboard.js script so it ships with\n your site. In your `conf.py` file, add the following function/lines (or add to one you've already\n got defined).\n\n ```python\n def setup(app):\n     app.add_stylesheet('custom.css')\n     app.add_javascript(\"custom.js\")\n     app.add_javascript(\"https://cdn.jsdelivr.net/npm/clipboard@1/dist/clipboard.min.js\")","position":{"start":{"line":108,"column":1},"end":{"line":120,"column":1}},"key":"bhB1KLL2eA"},{"type":"paragraph","position":{"start":{"line":122,"column":1},"end":{"line":124,"column":1}},"children":[{"type":"text","value":"And that’s it! Once you clear your Sphinx cache and re-build your site, you should\nnow have buttons that appear when you hover over them, and that copy\nthe text inside when you click them.","position":{"start":{"line":122,"column":1},"end":{"line":122,"column":1}},"key":"GZvNgts04k"}],"key":"IotbyxGHql"},{"type":"heading","depth":2,"position":{"start":{"line":126,"column":1},"end":{"line":126,"column":1}},"children":[{"type":"text","value":"Thanks","position":{"start":{"line":126,"column":1},"end":{"line":126,"column":1}},"key":"f7OtmsLWNp"}],"identifier":"thanks","label":"Thanks","html_id":"thanks","implicit":true,"key":"pavPnnk7td"},{"type":"paragraph","position":{"start":{"line":128,"column":1},"end":{"line":129,"column":1}},"children":[{"type":"text","value":"Many thanks to ","position":{"start":{"line":128,"column":1},"end":{"line":128,"column":1}},"key":"s0k4zM0FQE"},{"type":"link","url":"https://stackoverflow.com/a/48078807/1927102","position":{"start":{"line":128,"column":1},"end":{"line":128,"column":1}},"children":[{"type":"text","value":"this StackOverflow post","position":{"start":{"line":128,"column":1},"end":{"line":128,"column":1}},"key":"IpHWm29ans"}],"urlSource":"https://stackoverflow.com/a/48078807/1927102","key":"SyXSrYM3FA"},{"type":"text","value":"\nfor the majority of the code that led to this hack!","position":{"start":{"line":128,"column":1},"end":{"line":128,"column":1}},"key":"LVimtpPD27"}],"key":"ema4dI78p3"}],"key":"kJcQZUT9B5"}],"key":"JvcgLdFicn"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"I like Rust’s governance structure","url":"/blog/2018/rust-governance","group":"2018"},"next":{"title":"Matplotlib Cyclers are Great","url":"/blog/2017/2017-01-04-matplotlib-cycles","group":"2017"}}},"domain":"http://localhost:3000"}