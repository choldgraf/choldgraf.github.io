{"kind":"Article","sha256":"47438f5605a1a1543e8e8b10f88340cf40486029335f6aaf7d5ddc8c906f1cc4","slug":"blog.2022.phantom-workflows-pull-requests","location":"/blog/2022/phantom-workflows-pull-requests.md","dependencies":[],"frontmatter":{"title":"Fix phantom GitHub workflows in your ci-cd with protected branch rules","tags":["cicd","github actions"],"date":"2022-11-27","content_includes_title":false,"github":"https://github.com/choldgraf/choldgraf.github.io","thumbnail":"/build/abdd690fd5af613c25b40bb16d6ca824.png","exports":[{"format":"md","filename":"phantom-workflows-pull-requests.md","url":"/build/phantom-workflows-pu-fa40fd289742e2f75811d67aea9d0cc8.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"Have you ever had a GitHub pull request show “phantom” workflows that never pass?\nThis looks like one or more workflows that are in a constant ","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"ZjDAPhmwGn"},{"type":"strong","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"waiting state","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"e84wVxlosh"}],"key":"fMWdHcRuHl"},{"type":"text","value":", with a yellow status indicator, and that never complete.","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"WBRWphdPAw"}],"key":"nymD8COOje"},{"type":"paragraph","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"It looks something like this:","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"rGG2sGHUV0"}],"key":"i5xrivMeGC"},{"type":"image","url":"/build/abdd690fd5af613c25b40bb16d6ca824.png","align":"center","key":"ED9tLLpkMt","urlSource":"https://user-images.githubusercontent.com/1839645/204134864-da2541f0-ff4f-4d9f-8c80-aa8c4437d8a0.png"},{"type":"paragraph","position":{"start":{"line":19,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"If you run into this, it may be because of ","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"TG2iE10zdU"},{"type":"link","url":"https://docs.github.com/en/repositories/configuring-branches-and-merges-in-your-repository/defining-the-mergeability-of-pull-requests/about-protected-branches","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"branch protection rules","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"tu925EbAVH"}],"urlSource":"https://docs.github.com/en/repositories/configuring-branches-and-merges-in-your-repository/defining-the-mergeability-of-pull-requests/about-protected-branches","key":"FDOvJLoOTI"},{"type":"text","value":" in their repository.\nThese allow you to ensure that certain conditions are met before a pull request can be merged.","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"RqSrUeOHFZ"}],"key":"RUExZsa7DA"},{"type":"paragraph","position":{"start":{"line":22,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"text","value":"In particular, a common step is to ","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"p931BGWrQk"},{"type":"strong","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"text","value":"ensure that a certain GitHub Workflow passes before you can merge","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"NkaCdXG2y5"}],"key":"t3ZuTe3Bv6"},{"type":"text","value":".\nThis is often the source of the phantom workflows that never complete.\nThis is configured via ","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"DQjhuuXoVX"},{"type":"inlineCode","value":"settings","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"BVOkg8nrHa"},{"type":"text","value":" -> ","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"F6GYSVE3xR"},{"type":"inlineCode","value":"branches","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"bLim7lUh8U"},{"type":"text","value":" -> ","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"V9LsQ20yV7"},{"type":"inlineCode","value":"branch protection rules","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"he0V7sStBn"},{"type":"text","value":", like so:","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"PcFTyROZv6"}],"key":"DcNkSD8tpR"},{"type":"image","url":"/build/0c07afb2ee1b1197062aaa96da4cc14c.png","align":"center","key":"eOGq7i4Lx9","urlSource":"https://user-images.githubusercontent.com/1839645/204134952-fb5b8aa5-f8bb-4bd9-92ec-c66bf653387a.png"},{"type":"paragraph","position":{"start":{"line":29,"column":1},"end":{"line":30,"column":1}},"children":[{"type":"text","value":"If you ","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"txxxsqwv1B"},{"type":"strong","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"children":[{"type":"text","value":"specify a test here, and then delete it in your ","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"YPCm5zXsxJ"},{"type":"inlineCode","value":"YAML","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"nLWf8eZQQM"},{"type":"text","value":" configuration file, this will cause phantom workflows in your Pull Requests","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"b3kMfU9jpl"}],"key":"m2uzcd9GVy"},{"type":"text","value":".\nGitHub will wait for the test to finish, because it is specified in your repository settings, but it will never finish because the test isn’t configured in your workflow configuration.","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"CuvAoxkxU8"}],"key":"KI1jRowB5j"},{"type":"paragraph","position":{"start":{"line":32,"column":1},"end":{"line":33,"column":1}},"children":[{"type":"text","value":"So, to fix it, you simply ","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"key":"UZEIfPawYQ"},{"type":"strong","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"children":[{"type":"text","value":"delete the entry in your protected branch rules associated with that test","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"key":"iVuzZaGGYj"}],"key":"r9QHBN1ZLf"},{"type":"text","value":".\nAs a result, GitHub will no longer wait for that test to complete, and you can merge away.","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"key":"O0Pc99AHOu"}],"key":"ikmSAlskrX"},{"type":"paragraph","position":{"start":{"line":35,"column":1},"end":{"line":36,"column":1}},"children":[{"type":"text","value":"This one has bitten me several times, and so I decided to just document it here for future reference.\n","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"mtBJTh3ayz"},{"type":"link","url":"https://jacobtomlinson.dev/","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"children":[{"type":"text","value":"Jacob Tomlinson","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"LOiz74Z8Ai"}],"urlSource":"https://jacobtomlinson.dev/","key":"HN6VPY7wX6"},{"type":"text","value":" was the one that first told me about this fix!","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"Lo5jScrNFO"}],"key":"aobTzoJs90"}],"key":"Pac9vhZq4V"}],"key":"Am4qD400ci"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Automatically updating my publications page with ORCID and doi.org","url":"/blog/2022/orcid-auto-update","group":"2022"},"next":{"title":"Automatically update pre-commit hook versions","url":"/blog/2022/precommit-autoupdate","group":"2022"}}},"domain":"http://localhost:3000"}