{"kind":"Notebook","sha256":"ea8180150fc1819c47ae4084d197f11ab8e205986800e3c12c13fc024cd23a77","slug":"blog.2015.2015-05-27-coherence-correlation","location":"/blog/2015/2015-05-27-coherence_correlation.ipynb","dependencies":[],"frontmatter":{"title":"Coherence vs. Correlation - a simple simulation","content_includes_title":true,"tags":["python","programming","timeseries","correlation"],"date":"2015-05-27","kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"authors":[{"id":"chris","nameParsed":{"literal":"Chris Holdgraf","given":"Chris","family":"Holdgraf"},"name":"Chris Holdgraf","orcid":"0000-0002-2391-0678","affiliations":["affiliations-myst-generated-uid-0","affiliations-myst-generated-uid-1"],"twitter":"choldgraf","github":"choldgraf","url":"https://chrisholdgraf.com"}],"github":"https://github.com/choldgraf/choldgraf.github.io","affiliations":[{"name":"2i2c","url":"https://2i2c.org","id":"affiliations-myst-generated-uid-0"},{"name":"Project Jupyter","url":"https://jupyter.org","id":"affiliations-myst-generated-uid-1"}],"thumbnail":"/build/eeg_coh-00d2dee280275f7bc397961ad91aa608.png","exports":[{"format":"ipynb","filename":"2015-05-27-coherence_correlation.ipynb","url":"/build/2015-05-27-coherence-06e3c20a6c4477e68e3dcbda4b706985.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"code","lang":"","value":"---\ncategory: til\ndate: '2015-05-27'\nkernelspec:\n  display_name: Python 3 (ipykernel)\n  language: python\n  name: python3\nlanguage_info:\n  codemirror_mode:\n    name: ipython\n    version: 3\n  file_extension: .py\n  mimetype: text/x-python\n  name: python\n  nbconvert_exporter: python\n  pygments_lexer: ipython3\n  version: 3.10.14\nredirect: coherence-correlation-comparison\ntags:\n- python\n- programming\n- timeseries\n- correlation\ntitle: Coherence correlation\n---","key":"tNS8e53Lfu"}],"key":"aW0Zt4Zs2U"},{"type":"block","kind":"notebook-content","data":{"editable":true,"slideshow":{"slide_type":""},"tags":[]},"children":[{"type":"thematicBreak","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"FFwqqEJc0s"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"category: til\ndate: ‘2015-05-27’\nkernelspec:\ndisplay_name: Python 3 (ipykernel)\nlanguage: python\nname: python3\nlanguage_info:\ncodemirror_mode:\nname: ipython\nversion: 3\nfile_extension: .py\nmimetype: text/x-python\nname: python\nnbconvert_exporter: python\npygments_lexer: ipython3\nversion: 3.10.14\nredirect: coherence-correlation-comparison\ntags:","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"hBYB8xy0wa"}],"key":"s4075huP2J"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":20,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"python","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"KRXUd3IpgJ"}],"key":"Q6JXI2ifNS"},{"type":"listItem","spread":true,"position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"programming","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"Sot5iA7Rlz"}],"key":"dtliHpCbCY"},{"type":"listItem","spread":true,"position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"text","value":"timeseries","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"jg3PvUFLCW"}],"key":"x07O7i7eUi"},{"type":"listItem","spread":true,"position":{"start":{"line":23,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"text","value":"correlation\ntitle: Coherence correlation","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"HnVyxllVmf"}],"key":"uEiLpsyQeH"}],"key":"uiiRgle85C"},{"type":"thematicBreak","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"XwjLNRDKQ8"},{"type":"paragraph","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"text","value":"Note - you can find the nbviewer of this post ","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"nVnwsKOFMk"},{"type":"link","url":"https://github.com/choldgraf/write-ups/blob/master/neuro/coherence_correlation.ipynb","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"text","value":"here","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"NO8eXz3B5g"}],"urlSource":"https://github.com/choldgraf/write-ups/blob/master/neuro/coherence_correlation.ipynb","data":{"kind":"file","org":"choldgraf","repo":"write-ups","reference":"master","file":"neuro/coherence_correlation.ipynb","raw":"https://raw.githubusercontent.com/choldgraf/write-ups/master/neuro/coherence_correlation.ipynb"},"internal":false,"protocol":"github","key":"RbA6cbS4jF"}],"key":"kLUpNlsQz8"}],"key":"xByKV6CAqb"},{"type":"heading","depth":1,"position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"children":[{"type":"text","value":"Coherence vs. Correlation - a simple simulation","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"PWHKoXyPQV"}],"identifier":"coherence-vs-correlation-a-simple-simulation","label":"Coherence vs. Correlation - a simple simulation","html_id":"coherence-vs-correlation-a-simple-simulation","implicit":true,"key":"Eu09QkuUeg"},{"type":"paragraph","position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"children":[{"type":"text","value":"A big question that I’ve always wrestled with is the difference between correlation and coherence. Intuitively, I think of these two things as very similar to one another. Correlation is a way to determine the extent to which two variables covary (normalized to be between -1 and 1). Coherence is similar, but instead assesses “similarity” by looking at the similarity for two variables in frequency space, rather than time space.","position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"key":"qfDB2V5h7Q"}],"key":"KMsIwx9GlZ"},{"type":"paragraph","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"children":[{"type":"text","value":"There was a nice paper that came out a while back that basically compared these two methods in order to see when they’d produce the same result, when they’d produce different results, and when they’d break down [1]. They made a lot of nice plots like this:","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"key":"iCzRq9LxrM"}],"key":"ToIg5LEXGk"}],"visibility":"show","key":"XbzZP5dVqn"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"image","style":{"width":"300px"},"url":"/build/eeg_coh-00d2dee280275f7bc397961ad91aa608.png","key":"k4cSgLazjG","urlSource":"../../images/2015/eeg_coh.png"}],"key":"gzGYI3AMWN"},{"type":"block","kind":"notebook-content","data":{"editable":true,"slideshow":{"slide_type":""},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Here I am recreating this result in the hopes of giving people a set of scripts to play around with, and giving a bit more intuition.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Xe8LjPWxaB"}],"key":"GHjUoy4D37"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"[1] ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"f8sHiyklAF"},{"type":"link","url":"http://www.ncbi.nlm.nih.gov/pubmed/8947780","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"http://​www​.ncbi​.nlm​.nih​.gov​/pubmed​/8947780","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"N4Fs2OHd82"}],"urlSource":"http://www.ncbi.nlm.nih.gov/pubmed/8947780","key":"OP1aDwKPaS"}],"key":"hoAnwUI54E"},{"type":"thematicBreak","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"pyZcbA4gun"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"First things first, we’ll import some tools to use","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"RzPZPi9DJz"}],"key":"s7RoLw9loz"}],"visibility":"show","key":"k8giPMRHXY"},{"type":"block","kind":"notebook-code","data":{"collapsed":false,"editable":true,"jupyter":{"outputs_hidden":false},"slideshow":{"slide_type":""},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"import pandas as pd\nimport mne\nfrom itertools import product\nimport numpy as np\nimport seaborn as sns\nfrom matplotlib import pyplot as plt\nsns.set_style('white')\n%matplotlib inline","visibility":"show","key":"RqJIrJGHJc"},{"type":"output","id":"HMQh3RB9YqQ11AqouN0Gd","data":[],"visibility":"show","key":"raPYQzxjRS"}],"visibility":"show","key":"FpOA1Hv4rh"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Creating our sine waves","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"wsJQbSkkYH"}],"identifier":"creating-our-sine-waves","label":"Creating our sine waves","html_id":"creating-our-sine-waves","implicit":true,"key":"g2WVxf94hq"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Recall that the equation for a sinusoidal wave is:","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"miq8dtURmz"}],"key":"g4qSnfTlHB"},{"type":"math","value":"Asin(2{\\pi}ft + 2\\pi\\phi)","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>A</mi><mi>s</mi><mi>i</mi><mi>n</mi><mo stretchy=\"false\">(</mo><mn>2</mn><mi>π</mi><mi>f</mi><mi>t</mi><mo>+</mo><mn>2</mn><mi>π</mi><mi>ϕ</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">Asin(2{\\pi}ft + 2\\pi\\phi)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">A</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">in</span><span class=\"mopen\">(</span><span class=\"mord\">2</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π</span></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mord mathnormal\">t</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">2</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π</span><span class=\"mord mathnormal\">ϕ</span><span class=\"mclose\">)</span></span></span></span></span>","enumerator":"1","key":"DFUknJgqp0"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Where ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"WQ0ymq9wje"},{"type":"inlineMath","value":"f","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi></mrow><annotation encoding=\"application/x-tex\">f</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span></span></span></span>","key":"EMjmOOhI5t"},{"type":"text","value":" is the frequency of the wave, ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"sMMVLQaQFA"}],"key":"oa4B4HI5Ng"},{"type":"math","value":"t","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"tight":true,"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>t</mi></mrow><annotation encoding=\"application/x-tex\">t</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6151em;\"></span><span class=\"mord mathnormal\">t</span></span></span></span></span>","enumerator":"2","key":"anfpWNx0SY"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":" indexes time, and ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"Xw4ktJ1ukq"}],"key":"ze876XYbkh"},{"type":"math","value":"2\\pi\\phi","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"tight":true,"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mn>2</mn><mi>π</mi><mi>ϕ</mi></mrow><annotation encoding=\"application/x-tex\">2\\pi\\phi</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord\">2</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π</span><span class=\"mord mathnormal\">ϕ</span></span></span></span></span>","enumerator":"3","key":"yBzWzRc9PX"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":" defines a phase offset of the wave. Then, ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"D1YL5P4UV7"}],"key":"dZiOpjcdPM"},{"type":"math","value":"A","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"tight":true,"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>A</mi></mrow><annotation encoding=\"application/x-tex\">A</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\">A</span></span></span></span></span>","enumerator":"4","key":"yVwZpG8uQq"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":" scales the wave’s amplitude.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"egTK9tfHDi"}],"key":"SHQQBk5mqY"}],"key":"VSRXseJ3QN"},{"type":"block","kind":"notebook-code","data":{"collapsed":false,"jupyter":{"outputs_hidden":false}},"children":[{"type":"code","lang":"python","executable":true,"value":"# We can generate these sine wave parameters, then stitch them together\namplitude_values = [1, 3, 10, 15]\nphase_values = [0, .25, .33, .5]\nfreq = 2\nsignal_vals = list(product(amplitude_values, phase_values))\namps, phases = zip(*signal_vals)\n\n# We'll also define some noise levels to see how this affects results\nnoise_levels = [0, 2, 4, 8]\n\n# Now define how long these signals will be\nt_stop = 50\ntime = np.arange(0, t_stop, .01)\n\n# We're storing everything in dataframes, so create some indices\nix_amp = pd.Index(amps, name='amp')\nix_phase = pd.Index(phases, name='phase')\n\n# Create all our signals\nsignals = []\nfor noise_level in noise_levels:\n    sig_ = np.array([amp * np.sin(freq*2*np.pi*time + 2*np.pi*phase) for amp, phase in signal_vals])\n    noise = noise_level * np.random.randn(*sig_.shape)\n    sig_ += noise\n    ix_noise = pd.Index([noise_level]*sig_.shape[0], name='noise_level')\n    ix_multi = pd.MultiIndex.from_arrays([ix_amp, ix_phase, ix_noise])\n    signals.append(pd.DataFrame(sig_, index=ix_multi))\nsignals = pd.concat(signals, 0)\nsignals.columns.name = 'time'","key":"wlKKnYbG7I"},{"type":"output","id":"mF6V-OhRyyuqredLTiHD8","data":[],"key":"J5sqxdKS3j"}],"key":"L3Z3f4Up2y"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Computing connectivity","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"kDL7Ha79jQ"}],"identifier":"computing-connectivity","label":"Computing connectivity","html_id":"computing-connectivity","implicit":true,"key":"Cr92UBaGoR"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Now we’ve got a bunch of sinewaves with the parameters chosen above. Next, we will calculate the coherence and the correlation between all pairs of signals. This way we can see how these values change for different kinds of input signals.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"tFUZvsoCej"}],"key":"aDvA1j2Vtd"}],"key":"wXrHjFsFvE"},{"type":"block","kind":"notebook-code","data":{"collapsed":false,"jupyter":{"outputs_hidden":false}},"children":[{"type":"code","lang":"python","executable":true,"value":"con_all = []\nfor ix_noise, sig in signals.groupby(level='noise_level'):\n    # Setting up output indices\n    this_noise_level = sig.index.get_level_values('noise_level').unique()[0]\n    ix_ref = np.where(sig.eval('amp==3 and phase==0'))[0][0]\n    ix_time = pd.Index(range(sig.shape[0]), name='time')\n    ix_cc = pd.Index(['cc']*sig.shape[0], name='con')\n    ix_coh = pd.Index(['coh']*sig.shape[0], name='con')\n\n    # Calculating correlation is easy with pandas\n    cc = sig.T.corr().astype(float).iloc[:, ix_ref]\n    cc.name = None\n    cc = pd.DataFrame(cc)\n    # We'll use MNE for coherenece\n    indices = (np.arange(sig.shape[0]), ix_ref.repeat(sig.shape[0]))\n    con, freqs, times, epochs, tapers = mne.connectivity.spectral_connectivity(\n        sig.values[None, :, :], sfreq=freq, indices=indices)\n    con_mn = con.mean(-1)\n    con_mn = pd.DataFrame(con_mn, index=cc.index)\n    \n    # Final prep\n    con_mn = con_mn.set_index(ix_coh, append=True)\n    cc = cc.set_index(ix_cc, append=True)\n    con_all += ([con_mn, cc])\ncon_all = pd.concat(con_all, axis=0).squeeze().unstack('noise_level')","key":"L9QtmylJwk"},{"type":"output","id":"Vaq7ZlJ2XtJ4DXR_i363X","data":[],"key":"U7amquHLh7"}],"key":"whwGM3kUHy"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Visualizing results","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Cq1TVlwmWo"}],"identifier":"visualizing-results","label":"Visualizing results","html_id":"visualizing-results","implicit":true,"key":"wEIseaR90m"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"First off, we’ll look at what happens to sine waves of varying parameters, for different levels of noise.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"E1bZqPnVMS"}],"key":"D1jlhEEsmA"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Remember, each tuple is (amplitude, phase_lag). The first number controls how large the signal is, and the second controls the difference in phase between two sine waves.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"J6GWLiTNz5"}],"key":"IWGbpEVfIV"}],"key":"S8AA5EunFB"},{"type":"block","kind":"notebook-code","data":{"collapsed":false,"jupyter":{"outputs_hidden":false}},"children":[{"type":"code","lang":"python","executable":true,"value":"f, axs = plt.subplots(2, 2, figsize=(15, 10))\nfor ax, (noise, vals) in zip(axs.ravel(), con_all.iteritems()):\n    ax = vals.unstack('con').plot(ax=ax)\n    ax.set_title('Noise level: {0}'.format(noise))\n    ax.set_ylim([-1.1, 1.1])","key":"eAWhZrbrIx"},{"type":"output","id":"H7RPibSpfOnRqI5bh8Nu-","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"986712d2085c27771c889262fe3131c9","path":"/build/986712d2085c27771c889262fe3131c9.png"}}}],"key":"jikNxRpWVQ"}],"key":"NJpG8ygPtA"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"That’s already an interesting picture - as you can see, coherence is far more robust to differences between the two signals. Here are a few thoughts:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"zZmfVeSiQm"}],"key":"Ca5kLd4Ayy"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Correlation varies widely (between 0 and 1) for differences in phase lag. However, coherence remains relatively stable.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"xlesZN0Hb8"}],"key":"SXZ5l6XVGj"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Coherence values are smaller in general for a signal with any noise","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"T9xaKVz4Lb"}],"key":"NTwky9HQRg"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"However, coherence is more robust for increasing levels of noise, while correlations start to drop to 0","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"aQamGbQHeI"}],"key":"cTGytLuHUO"}],"key":"StLyjVIDSK"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"To illustrate number 1, let’s plot correlation and coherence against each other:","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"wPVXtG5meP"}],"key":"FzOvmjSnKD"}],"key":"qRU62llrhX"},{"type":"block","kind":"notebook-code","data":{"collapsed":false,"jupyter":{"outputs_hidden":false}},"children":[{"type":"code","lang":"python","executable":true,"value":"plt_df = con_all.stack('noise_level').unstack('con').reset_index('noise_level')\nax = plt_df.plot('cc', 'coh', c='noise_level', kind='scatter',\n                 cmap=plt.cm.Reds, figsize=(10, 5), alpha=.5, s=50)\nax.set_title('CC vs Coherence')","key":"Poxy25OI7l"},{"type":"output","id":"1ajDDX92yuVlZXaZ2rvjc","data":[{"output_type":"execute_result","execution_count":14,"metadata":{},"data":{}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"81de8b82a8f3702c66f0df07c831515f","path":"/build/81de8b82a8f3702c66f0df07c831515f.png"}}}],"key":"U6F3SRPA3O"}],"key":"BiaoQcLLSd"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"As you can see here, coherence remains the same (except for when it occasionally increases to 1) while correlation is much more dependent on the phase relationship between the signals. Moreover, as the signal SNR degrades, the correlation shrinks to 0, while the coherence remains the same.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VvCe0Waq1L"}],"key":"RjhftEWxMT"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Let’s take a look at how the correlation and coherence relate to the actual shape of the signals:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"eYMtVkZeXK"}],"key":"V9SgGd9c35"}],"key":"CvTROWEcO3"},{"type":"block","kind":"notebook-code","data":{"collapsed":false,"jupyter":{"outputs_hidden":false}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Set up a dataframe for plotting\nnoise_level = noise_levels[1]\nplt_df = con_all.copy()\nplt_df = con_all[noise_level].unstack('con')\n\n# Define 16 signals to plot\nsig_combinations = list(product([ix_ref], range(16)))\n\nplt_sig = signals.xs(noise_level, level='noise_level')\nn_combs = len(sig_combinations)\nf, axs = plt.subplots(n_combs/4, 4, figsize=(15, n_combs/3*5))\nfor (comp_a, comp_b), ax in zip(sig_combinations, axs.ravel()):\n    plt_sig.iloc[[comp_a, comp_b]].T.head(250).plot(ax=ax, legend=None)\n    ax.set_title('CC: {0}\\nCoh: {1}'.format(*plt_df.iloc[comp_b, :].values))","key":"JpeeyLPBfw"},{"type":"output","id":"2ZpeIrbqSCj4506y08DJc","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"5866c79b2b38425c42d394775933d754","path":"/build/5866c79b2b38425c42d394775933d754.png"}}}],"key":"oTtxCdyJXc"}],"key":"srzHDB0T4a"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Another way of looking at it with scatterplots...","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"mFB6CLnCtm"}],"key":"DVIQubs7g9"}],"key":"ycrZmdk6Uy"},{"type":"block","kind":"notebook-code","data":{"collapsed":false,"jupyter":{"outputs_hidden":false}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Set up a dataframe for plotting\nnoise_level = noise_levels[1]\nplt_df = con_all.copy()\nplt_df = con_all[noise_level].unstack('con')\n\n# Define 16 signals to plot\nsig_combinations = list(product([ix_ref], range(16)))\n\nplt_sig = signals.xs(noise_level, level='noise_level')\nn_combs = len(sig_combinations)\nf, axs = plt.subplots(n_combs/4, 4, figsize=(15, n_combs/3*5))\nfor (comp_a, comp_b), ax in zip(sig_combinations, axs.ravel()):\n    iia, iib = plt_sig.iloc[[comp_a, comp_b]].T.head(250).values.T\n    ax.scatter(iia, iib)\n    ax.set_title('CC: {0}\\nCoh: {1}'.format(*plt_df.iloc[comp_b, :].values))","key":"sU6Xc943TO"},{"type":"output","id":"vnXfZE8GM2jXya86D5y0u","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"8f02d5c98c6b592149d2808a424b1cec","path":"/build/8f02d5c98c6b592149d2808a424b1cec.png"}}}],"key":"Pb6z0Nd180"}],"key":"aMn1JtvJav"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Finally, for a more direct comparison, we can look directly at the difference between the two as a function of both noise level and the sine wave parameters.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"MQXbgMkgY0"}],"key":"Cmc9ll4zPZ"}],"key":"fIC6wFZbYc"},{"type":"block","kind":"notebook-code","data":{"collapsed":false,"jupyter":{"outputs_hidden":false}},"children":[{"type":"code","lang":"python","executable":true,"value":"diff_con = con_all.stack('noise_level').unstack('con')\ndiff = diff_con['cc'] - diff_con['coh']\ndiff = diff.unstack('noise_level')","key":"bTwk7q53UK"},{"type":"output","id":"jRKth7P4jH5Tg_hfDaySd","data":[],"key":"PVZkFMmUh0"}],"key":"nPWyAAkNDs"},{"type":"block","kind":"notebook-code","data":{"collapsed":false,"jupyter":{"outputs_hidden":false}},"children":[{"type":"code","lang":"python","executable":true,"value":"diff.plot(figsize=(15, 5))","key":"hKU2pivh5g"},{"type":"output","id":"o1LXOshPpafwlxIrW1yAz","data":[{"output_type":"execute_result","execution_count":19,"metadata":{},"data":{}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"4a163ae44e9a50c20edf416831cf2144","path":"/build/4a163ae44e9a50c20edf416831cf2144.png"}}}],"key":"RY0sQhxVui"}],"key":"FR1BfXf9aK"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"So what does this mean? Well, the relationship between coherence and correlation is too complicated to sum it up in a single line or two. However, it is clear that correlation is more sensitive to differences between signals in time. Coherence, on the other hand, is more reliable for these differences. Moreover, correlation degrades quickly with an increase in noise, while coherence remains the same.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"XQ5Xe9VdbJ"}],"key":"XjydT5n9zz"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"As such, if you care about understanding the relationship between two signals as it pertains to time, then perhaps correlation is the way to go. On the other hand, if you want a robust estimate of the amount of overlap in the structure of two signals, then coherence may be the best bet.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"BVgcGi7SVi"}],"key":"xX4FS01vjR"}],"key":"v6DAthK0Zz"}],"key":"XuQQYWwGuL"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Brainy Jingle Bells","url":"/blog/2016/2016-12-23-christmas-ecog-plot","group":"2016"},"next":{"title":"Scraping craigslist","url":"/blog/2015/2015-08-30-craigslist-scrape","group":"2015"}}},"domain":"http://localhost:3000"}