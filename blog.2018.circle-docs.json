{"version":1,"kind":"Article","sha256":"bf61586b6e736dab27bac4958f39f900c4fb4c8d1c8c0b793eaeb5009ac8b7ca","slug":"blog.2018.circle-docs","location":"/blog/2018/circle-docs.md","dependencies":[],"frontmatter":{"title":"Using CircleCI to preview documentation in Pull Requests","tags":["documentation","sphinx"],"date":"2018-10-16","content_includes_title":false,"authors":[{"id":"chris","nameParsed":{"literal":"Chris Holdgraf","given":"Chris","family":"Holdgraf"},"name":"Chris Holdgraf","orcid":"0000-0002-2391-0678","affiliations":["affiliations-myst-generated-uid-0","affiliations-myst-generated-uid-1"],"twitter":"choldgraf","github":"choldgraf","url":"https://chrisholdgraf.com"}],"github":"https://github.com/choldgraf/choldgraf.github.io","affiliations":[{"name":"2i2c","url":"https://2i2c.org","id":"affiliations-myst-generated-uid-0"},{"name":"Project Jupyter","url":"https://jupyter.org","id":"affiliations-myst-generated-uid-1"}],"abbreviations":{"LF":"The Linux Foundation","JF":"The Jupyter Foundation","JEC":"Jupyter Executive Council","JFB":"The Jupyter Foundation Board","SSC":"Software Steering Council","OSPO":"Open Source Program Office"},"numbering":{"title":{"offset":2}},"edit_url":"https://github.com/choldgraf/choldgraf.github.io/blob/main/blog/2018/circle-docs.md","thumbnail":"/build/sphinx-circle-logos-eba88c9a8122983559bb4dc5bbce06da.png","exports":[{"format":"md","filename":"circle-docs.md","url":"/build/circle-docs-09cfeb7d8ac5e27dfc2d79610bb7d304.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":12,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Writing documentation is important - it’s the first point of contact between many users and your\nproject, and can be a pivotal moment in whether they decide to adopt your tech or become a contributor.","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"sBR1RS2Pmx"}],"key":"hnMl8kxYEs"},{"type":"paragraph","position":{"start":{"line":15,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"However, it can be a pain to iterate on documentation, as it is often involves a lot of rapid iteration\nlocally, followed by a push to GitHub where you “just trust” that the author has done a good job of\nwriting content, design, etc.","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"t5BE1FgnGy"}],"key":"T7Z53NltIm"},{"type":"paragraph","position":{"start":{"line":19,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"A really helpful tip here is to use Continuous Integration to build and preview your documentation. This\nallows you to generate a link to the build docs, which is a much better way of reviewing than looking at\nthe raw text.","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"gEh0MyZX4p"}],"key":"gnuAnTxfPm"},{"type":"image","url":"/build/sphinx-circle-logos-eba88c9a8122983559bb4dc5bbce06da.png","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"MhOKA116Gp","urlSource":"../../images/2018/sphinx-circle-logos.png"},{"type":"paragraph","position":{"start":{"line":26,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"text","value":"Here’s a simple CircleCI configuration that you can use to build documentation with Sphinx and store it\nas an artifact in the build that you can then preview. To set this up, follow these steps:","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"GhxOIQ8Kp4"}],"key":"AVgyaRNKGQ"},{"type":"heading","depth":2,"position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"children":[{"type":"text","value":"Configure CircleCI","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"rIpqjRb2Yk"}],"identifier":"configure-circleci","label":"Configure CircleCI","html_id":"configure-circleci","implicit":true,"key":"ZomUaC9iZ9"},{"type":"paragraph","position":{"start":{"line":31,"column":1},"end":{"line":33,"column":1}},"children":[{"type":"text","value":"First off, you need to configure CircleCI to build your page. This involves creating a file called ","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"m3xnPM03aS"},{"type":"inlineCode","value":".circle/config.yml","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"cQnXYHB2zX"},{"type":"text","value":"\nthat Circle will use to decide what to do each time your page is built. You then need to go to the CircleCI\nwebsite and tell it to build your site.","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"oJOu45qKUT"}],"key":"OQGj3Wku8V"},{"type":"paragraph","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"children":[{"type":"text","value":"Here’s a skeleton configuration that will build the documentation with Sphinx:","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"NkBB8xoi2g"}],"key":"caCSZPuJjW"},{"type":"code","lang":"yaml","value":"version: 2\njobs:\n  # Define a \"build_docs\" job to be run with Circle\n  build_docs:\n    # This is the base environment that Circle will use\n    docker:\n      - image: circleci/python:3.6-stretch\n    steps:\n      # Get our data and merge with upstream\n      - run: sudo apt-get update\n      - checkout\n      # Update our path\n      - run: echo \"export PATH=~/.local/bin:$PATH\" >> $BASH_ENV\n      # Restore cached files to speed things up\n      - restore_cache:\n          keys:\n            - cache-pip\n      # Install the packages needed to build our documentation\n      # This will depend on your particular package!\n      - run: pip install --user sphinx_rtd_theme sphinx pytest memory_profiler recommonmark sphinx_copybutton jupyterhub\n      # Cache some files for a speedup in subsequent builds\n      - save_cache:\n          key: cache-pip\n          paths:\n            - ~/.cache/pip\n      # Build the docs\n      - run:\n          name: Build docs to store\n          command: |\n            cd doc\n            make html\n      # Tell Circle to store the documentation output in a folder that we can access later\n      - store_artifacts:\n          path: doc/_build/html/\n          destination: html\n\n# Tell CircleCI to use this workflow when it builds the site\nworkflows:\n  version: 2\n  default:\n    jobs:\n      - build_docs","position":{"start":{"line":37,"column":1},"end":{"line":80,"column":1}},"key":"ruVuD7SVpm"},{"type":"paragraph","position":{"start":{"line":82,"column":1},"end":{"line":82,"column":1}},"children":[{"type":"text","value":"See the comments above for what each step does.","position":{"start":{"line":82,"column":1},"end":{"line":82,"column":1}},"key":"ZnEw3MRyOK"}],"key":"xVrnNz6x5U"},{"type":"heading","depth":2,"position":{"start":{"line":84,"column":1},"end":{"line":84,"column":1}},"children":[{"type":"text","value":"Tell CircleCI to build Pull Requests for your repository","position":{"start":{"line":84,"column":1},"end":{"line":84,"column":1}},"key":"DKWWtYmAzS"}],"identifier":"tell-circleci-to-build-pull-requests-for-your-repository","label":"Tell CircleCI to build Pull Requests for your repository","html_id":"tell-circleci-to-build-pull-requests-for-your-repository","implicit":true,"key":"kEeBIrlaM6"},{"type":"paragraph","position":{"start":{"line":86,"column":1},"end":{"line":88,"column":1}},"children":[{"type":"text","value":"Because we’re doing this in order to preview changes to the documentation in a Pull Request,\nwe now need to tell CircleCI to run builds on PRs to your repo. To do so, go to the CircleCI UI, click on “Jobs”, then click\nyour project name, then click the settings button here:","position":{"start":{"line":86,"column":1},"end":{"line":86,"column":1}},"key":"QEzylDDM1m"}],"key":"BcxH2XE3So"},{"type":"image","url":"/build/sphinx-circle-settin-71aa3fa0f9de026a6b5742e49b4b541b.png","position":{"start":{"line":90,"column":1},"end":{"line":90,"column":1}},"key":"brgMcTOg5q","urlSource":"../../images/2018/sphinx-circle-settings.png"},{"type":"paragraph","position":{"start":{"line":92,"column":1},"end":{"line":92,"column":1}},"children":[{"type":"text","value":"In the next page, click on ","position":{"start":{"line":92,"column":1},"end":{"line":92,"column":1}},"key":"zgD33nw5oS"},{"type":"strong","position":{"start":{"line":92,"column":1},"end":{"line":92,"column":1}},"children":[{"type":"text","value":"Advanced Settings","position":{"start":{"line":92,"column":1},"end":{"line":92,"column":1}},"key":"ZKcX0E8KJE"}],"key":"ouTian8gaI"},{"type":"text","value":", and finally switch on ","position":{"start":{"line":92,"column":1},"end":{"line":92,"column":1}},"key":"CYWsCEvqCM"},{"type":"strong","position":{"start":{"line":92,"column":1},"end":{"line":92,"column":1}},"children":[{"type":"text","value":"Build forked pull requests","position":{"start":{"line":92,"column":1},"end":{"line":92,"column":1}},"key":"ikRaWMUmuO"}],"key":"XIxyDmp0fF"},{"type":"text","value":".","position":{"start":{"line":92,"column":1},"end":{"line":92,"column":1}},"key":"FK0g4HvUbj"}],"key":"K5p7GW8d9C"},{"type":"paragraph","position":{"start":{"line":94,"column":1},"end":{"line":94,"column":1}},"children":[{"type":"text","value":"Now, Circle will build against the PRs of your repository.","position":{"start":{"line":94,"column":1},"end":{"line":94,"column":1}},"key":"vME4gRXUIL"}],"key":"m3AA27jdrg"},{"type":"heading","depth":2,"position":{"start":{"line":96,"column":1},"end":{"line":96,"column":1}},"children":[{"type":"text","value":"Make a Pull Request","position":{"start":{"line":96,"column":1},"end":{"line":96,"column":1}},"key":"vCdKZ1ZAFx"}],"identifier":"make-a-pull-request","label":"Make a Pull Request","html_id":"make-a-pull-request","implicit":true,"key":"nRPjlItAv9"},{"type":"paragraph","position":{"start":{"line":98,"column":1},"end":{"line":99,"column":1}},"children":[{"type":"text","value":"Now it’s time to test things out. Make a Pull Request for your repository. GitHub should automatically\ndetect a CircleCI configuration, and run the job with the configuration you’ve specified.","position":{"start":{"line":98,"column":1},"end":{"line":98,"column":1}},"key":"oGagozdlHi"}],"key":"FZPEWkpmX3"},{"type":"paragraph","position":{"start":{"line":101,"column":1},"end":{"line":102,"column":1}},"children":[{"type":"text","value":"Once the documentation is built (or if it fails) you can click on the CircleCI link from the GitHub UI\nin order to see what happened.","position":{"start":{"line":101,"column":1},"end":{"line":101,"column":1}},"key":"shCrxMpaMr"}],"key":"zqRPq049qW"},{"type":"image","url":"/build/sphinx-circle-github-07ceaf53415b55dc6f7c0bdd2266ec07.png","position":{"start":{"line":104,"column":1},"end":{"line":104,"column":1}},"key":"pFVvgp1Yak","urlSource":"../../images/2018/sphinx-circle-github-pr.png"},{"type":"heading","depth":2,"position":{"start":{"line":106,"column":1},"end":{"line":106,"column":1}},"children":[{"type":"text","value":"View your artifacts","position":{"start":{"line":106,"column":1},"end":{"line":106,"column":1}},"key":"e0oo0fNpOn"}],"identifier":"view-your-artifacts","label":"View your artifacts","html_id":"view-your-artifacts","implicit":true,"key":"ZQGiSDhYVt"},{"type":"paragraph","position":{"start":{"line":108,"column":1},"end":{"line":108,"column":1}},"children":[{"type":"text","value":"You should be taken to a page that shows a summary of the recent CircleCI build for this PR.","position":{"start":{"line":108,"column":1},"end":{"line":108,"column":1}},"key":"aHJTCLFiC3"}],"key":"FDXh0S6wGM"},{"type":"paragraph","position":{"start":{"line":110,"column":1},"end":{"line":112,"column":1}},"children":[{"type":"text","value":"If your documentation successfully built (and if you’ve told Sphinx to put the built site in ","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"key":"MxH03G9xjj"},{"type":"inlineCode","value":"doc/_build/","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"key":"lTonqPjfXb"},{"type":"text","value":") then\nyou can now click on the ","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"key":"SJSazDOHgy"},{"type":"strong","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"children":[{"type":"text","value":"Artifacts","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"key":"o0Uk7wmAqA"}],"key":"i71RrBZIX1"},{"type":"text","value":" tab. You should see a drop-down list of artifacts that CircleCI has\nstored for you. Click on ","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"key":"UadTaCmEb2"},{"type":"strong","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"children":[{"type":"text","value":"index.html","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"key":"Ypw69MDY3F"}],"key":"uvw179npMz"},{"type":"text","value":" and you should see a preview of your built documentation:","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"key":"udOvwRnnXj"}],"key":"YDXHiIvGxG"},{"type":"image","url":"/build/sphinx-circle-artifa-354927289a9e7e4d63e5cfa2970f202c.png","position":{"start":{"line":114,"column":1},"end":{"line":114,"column":1}},"key":"eG5zX5cNc1","urlSource":"../../images/2018/sphinx-circle-artifacts.png"},{"type":"paragraph","position":{"start":{"line":116,"column":1},"end":{"line":117,"column":1}},"children":[{"type":"text","value":"And that’s it! Obviously you can configure CircleCI in many more ways, but this is just a barebones example\nto get you started. I hope you’ve found it useful!","position":{"start":{"line":116,"column":1},"end":{"line":116,"column":1}},"key":"RbKZwxbIaB"}],"key":"tnlgrvlxuD"}],"key":"y8ccq4cTxh"}],"key":"eaHJ4uz4wd"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Automatically mirror a github repository with CircleCI","url":"/blog/2018/circlci-github","group":"2018"},"next":{"title":"Summer conference report back","url":"/blog/2018/conferences-summer-2018","group":"2018"}}},"domain":"http://localhost:3000"}